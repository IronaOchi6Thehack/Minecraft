(function(g){var window=this;'use strict';var su8=function(z){var K=new g.eA("und",new g.R6("Default","und",!0));K.captionTracks=z.captionTracks;return K},Ag8=function(z){return new g.Vh(function(K,f){var M=z.length,p=[];
if(M)for(var t=function(G,b){M--;p[G]=b;M==0&&K(p)},B=function(G){f(G)},v,I=0;I<z.length;I++)v=z[I],g.Ojd(v,g.Bo(t,I),B);
else K(p)})},iX=function(z){this.S=z},du=function(){iX.apply(this,arguments)},jup=function(){du.apply(this,arguments)},Yz5=function(){du.apply(this,arguments)},Xj_=function(){du.apply(this,arguments)},xxQ=function(){du.apply(this,arguments)},FT1=function(){du.apply(this,arguments)},OD_=function(){du.apply(this,arguments)},rgS=function(){iX.apply(this,arguments)},ZD7=function(){du.apply(this,arguments)},oFo=function(){du.apply(this,arguments)},CKS=function(){du.apply(this,arguments)},TFZ=function(){du.apply(this,
arguments)},UxQ=function(){du.apply(this,arguments)},zmZ=function(){du.apply(this,arguments)},K42=function(){du.apply(this,arguments)},$qS=function(){du.apply(this,arguments)},fq9=function(){du.apply(this,arguments)},M_9=function(){du.apply(this,arguments)},pF2=function(){du.apply(this,arguments)},t_T=function(){du.apply(this,arguments)},Bo1=function(){iX.apply(this,arguments)},No8=function(){du.apply(this,arguments)},vj9=function(){du.apply(this,arguments)},IqQ=function(){du.apply(this,arguments)},
G1p=function(){du.apply(this,arguments)},b_8=function(){du.apply(this,arguments)},emp=function(){du.apply(this,arguments)},wFo=function(){du.apply(this,arguments)},Dq8=function(){du.apply(this,arguments)},yb9=function(){du.apply(this,arguments)},k12=function(){iX.apply(this,arguments)},hmp=function(){iX.apply(this,arguments)},aqf=function(){iX.apply(this,arguments)},RmQ=function(){du.apply(this,arguments)},S09=function(){du.apply(this,arguments)},uU5=function(){du.apply(this,arguments)},L4o=function(){du.apply(this,
arguments)},Ejo=function(){du.apply(this,arguments)},PZT=function(){du.apply(this,arguments)},H_S=function(){du.apply(this,arguments)},QE9=function(){du.apply(this,arguments)},q0H=function(){du.apply(this,arguments)},mqf=function(){du.apply(this,arguments)},lq1=function(){du.apply(this,arguments)},V_f=function(){du.apply(this,arguments)},nj4=function(){du.apply(this,arguments)},W4S=function(){du.apply(this,arguments)},Jb_=function(){du.apply(this,arguments)},gj4=function(){du.apply(this,arguments)},
i_H=function(){du.apply(this,arguments)},dq1=function(){du.apply(this,arguments)},cbo=function(){du.apply(this,arguments)},sEo=function(){du.apply(this,arguments)},Abp=function(){du.apply(this,arguments)},jE1=function(){du.apply(this,arguments)},Y0S=function(){du.apply(this,arguments)},XF1=function(){du.apply(this,arguments)},xq2=function(){du.apply(this,arguments)},F4H=function(){du.apply(this,arguments)},O_Z=function(){iX.apply(this,arguments)},rb5=function(){du.apply(this,arguments)},Z_8=function(){du.apply(this,
arguments)},oj9=function(){du.apply(this,arguments)},CZT=function(){du.apply(this,arguments)},To2=function(){du.apply(this,arguments)},Uq2=function(){du.apply(this,arguments)},zy4=function(){du.apply(this,arguments)},KZ9=function(){du.apply(this,arguments)},$X4=function(){du.apply(this,arguments)},fP7=function(){du.apply(this,arguments)},Mk7=function(){du.apply(this,arguments)},pO5=function(){du.apply(this,arguments)},tk4=function(){du.apply(this,arguments)},BB1=function(){du.apply(this,arguments)},
NBT=function(){du.apply(this,arguments)},vZ7=function(){du.apply(this,arguments)},IPf=function(){du.apply(this,arguments)},GfS=function(){du.apply(this,arguments)},br7=function(){du.apply(this,arguments)},eyQ=function(){du.apply(this,arguments)},wOo=function(){du.apply(this,arguments)},DXf=function(){du.apply(this,arguments)},y89=function(){du.apply(this,arguments)},kf9=function(){du.apply(this,arguments)},hy2=function(){du.apply(this,arguments)},aP2=function(){du.apply(this,arguments)},Ry2=function(){du.apply(this,
arguments)},SA4=function(){du.apply(this,arguments)},uuH=function(){du.apply(this,arguments)},LZH=function(){du.apply(this,arguments)},EZQ=function(){du.apply(this,arguments)},PLZ=function(){du.apply(this,arguments)},HrQ=function(){du.apply(this,arguments)},QkH=function(z){z=z.key||z.id;
if(!z)throw Error("Entity key is missing");return z},qA1=function(){if(cH)return cH();
var z={};cH=g.pR("PersistentEntityStoreDb",{Nb:(z.EntityStore={qt:1},z.EntityAssociationStore={qt:2},z),shared:!1,upgrade:function(K,f){f(1)&&g.AO(g.JO(K,"EntityStore",{keyPath:"key"}),"entityType","entityType");f(2)&&(K=g.JO(K,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.AO(K,"byParentEntityKey","parentEntityKey"),g.AO(K,"byChildEntityKey","childEntityKey"))},
version:3});return cH()},mXH=function(z){return g.Zs(qA1(),z)},lP8=function(z){return g.Zs((0,g.D0Z)(),z)},s6=function(z){this.token=z},AF=function(z,K){K=K===void 0?{}:K;
g.UT.call(this,g.y$Q[z],Object.assign({},{name:"PESEncoderError",type:z},K));this.type=z;this.level="WARNING";Object.setPrototypeOf(this,AF.prototype)},Vk9=function(z){return new AF("WRONG_DATA_TYPE",{hv:z})},nZT=function(z){return z instanceof Error?new AF("UNKNOWN_ENCODE_ERROR",{originalMessage:z.message}):new AF("UNKNOWN_ENCODE_ERROR")},WZ7=function(z){return z instanceof Error?new AF("UNKNOWN_DECODE_ERROR",{originalMessage:z.message}):new AF("UNKNOWN_DECODE_ERROR")},J8Q=function(z,K){z=z instanceof
AF?z:K(z);
g.sm(z);throw z;},gZZ=function(){},irS=function(z,K,f){try{return z.T(K,f)}catch(M){J8Q(M,nZT)}},dX7=function(z){z=(new TextEncoder).encode(z).subarray(0,16);
var K=new Uint8Array(16);K.set(z);return K},jB=function(z){this.S=z},sk9=function(z){var K=c8p[z];
if(K)return K;g.Al(new g.UT("Entity model not found.",{entityType:z}))},A8S=function(z,K){this.S=z;
this.Y=K;this.T={}},YA4=function(z,K){a:{z=jkT(z.Y,K.version);
try{var f=z.Y(K.data,K.key);break a}catch(M){J8Q(M,WZ7)}f=void 0}return f},Yu=function(z,K,f){return z.S.objectStore("EntityStore").get(K).then(function(M){if(M){if(f&&M.entityType!==f)throw Error("Incorrect entity type");
return YA4(z,M)}})},Xo=function(z,K,f){return f?(f=f.map(function(M){return Yu(z,M,K)}),g.ma.all(f)):z.S.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(K)).then(function(M){return M.map(function(p){return YA4(z,p)})})},Fo=function(z,K,f){var M=QkH(K),p=jkT(z.Y,1),t=Object.assign({},K);
return z.S.objectStore("EntityStore").get(M).then(function(B){if(B){if(B.entityType!==f)throw Error("Incorrect entity type");t.entityMetadata||(B=YA4(z,B),t.entityMetadata=B.entityMetadata)}}).then(function(){var B={key:M,
entityType:f,data:irS(p,t,M),version:1};return g.ma.all([g.dg(z.S.objectStore("EntityStore"),B),XOH(z,t,f)])}).then(function(){xu(z,M,f);
return M})},xX8=function(z,K,f){K=K.map(function(M){return Fo(z,M,f)});
return g.ma.all(K)},O6=function(z,K,f){if(f==null?0:f.VS){var M=new Set;
return FZ4(z,K,M).then(function(){for(var t=[],B=g.a(M),v=B.next();!v.done;v=B.next())t.push(O6(z,v.value));return g.ma.all(t).then(function(){})})}var p=g.B_(K).entityType;
return g.ma.all([z.S.objectStore("EntityStore").delete(K),Or_(z,K)]).then(function(){xu(z,K,p)})},r81=function(z,K){return g.xi(z.S.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(K)},function(f){return g.ma.all([f.delete(),
Or_(z,f.cursor.primaryKey)]).then(function(){xu(z,f.cursor.primaryKey,K);return g.Yi(f)})})},Zrp=function(z,K,f,M){var p=jkT(z.Y,1);
return Yu(z,K,M).then(function(t){if(t){t=g.EB(t,f);var B={key:K,entityType:M,data:irS(p,t,K),version:1};return g.ma.all([g.dg(z.S.objectStore("EntityStore"),B),XOH(z,t,M)])}}).then(function(){xu(z,K,M);
return K})},xu=function(z,K,f){var M=z.T[f];
M||(M=new Set,z.T[f]=M);M.add(K)},oZT=function(z,K,f){var M=QkH(K);
f=sk9(f);if(!f)return g.ma.resolve([]);f=new f(K);z=z.S.objectStore("EntityAssociationStore");K=[];f=g.a(f.Y());for(var p=f.next();!p.done;p=f.next())K.push(g.dg(z,{parentEntityKey:M,childEntityKey:p.value}));return g.ma.all(K).then(function(t){return t.map(function(B){return B[1]})})},Or_=function(z,K){return z.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(K))},XOH=function(z,K,f){var M=QkH(K);
return Or_(z,M).then(function(){return oZT(z,K,f)})},FZ4=function(z,K,f){if(f.has(K))return g.ma.resolve(void 0);
f.add(K);return CL5(z,K).then(function(M){return z.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(K)).then(function(){return M})}).then(function(M){var p=g.ma.resolve(void 0);
M=g.a(M);for(var t=M.next(),B={};!t.done;B={Zy:void 0},t=M.next())B.Zy=t.value,p=p.then(function(v){return function(){return FZ4(z,v.Zy,f)}}(B));
return p}).then(function(){})},CL5=function(z,K){var f=z.S.objectStore("EntityAssociationStore");
return f.index("byParentEntityKey").getAll(IDBKeyRange.only(K)).then(function(M){var p=[];M=g.a(M);for(var t=M.next();!t.done;t=M.next())t=t.value,p.push(f.index("byChildEntityKey").getAll(t.childEntityKey));return g.ma.all(p)}).then(function(M){var p=[];
M=g.a(M);for(var t=M.next();!t.done;t=M.next())t=t.value,t.length===1&&p.push(t[0].childEntityKey);return p})},ru=function(){},TB_=function(){this.S={};
this.S[0]=new ru;if(!g.Hg("aes_pes_encoder_killswitch")){var z=this.S;try{var K=g.zN();var f=dX7(K);var M=new jB(new g.W_(f),new g.nf(f))}catch(p){throw z=p instanceof Error?new AF("KEY_CREATION_FAILED",{originalMessage:p.message}):new AF("KEY_CREATION_FAILED"),g.sm(z),z;}z[1]=M}},jkT=function(z,K){K=K===void 0?0:K;
z=z.S[K];if(!z)throw K=new AF("INVALID_ENCODER_VERSION",{hv:K}),g.sm(K),K;return z},Z7=function(z,K){g.J.call(this);
this.token=z;this.S=K;this.observers=[];z=new g.ZT.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.zN());z.onmessage=this.Y.bind(this);this.channel=z},om=function(z,K,f){var M,p,t,B;
return g.n(function(v){if(v.Y==1)return g.l(v,mXH(z.token),2);if(v.Y!=3)return M=v.S,g.l(v,g.iN(M,["EntityStore","EntityAssociationStore"],K,function(I){p=new A8S(I,z.S);return f(p)}),3);
t=v.S;p&&(B=p.T,Object.keys(B).length>0&&(z.channel.postMessage(B),UXo(z,B)));return v.return(t)})},C4=function(z,K,f){return om(z,{mode:"readwrite",
B1:!0},function(M){return Fo(M,K,f)})},zEH=function(z,K){return om(z,{mode:"readwrite",
B1:!0},function(f){return xX8(f,K,"offlineOrchestrationActionWrapperEntity")})},KVQ=function(z,K){return om(z,{mode:"readwrite",
B1:!0},function(f){return O6(f,K)})},$YQ=function(z){return om(z,{mode:"readwrite",
B1:!0},function(K){return r81(K,"videoPlaybackPositionEntity")})},TY=function(z,K,f){return om(z,{mode:"readonly",
B1:!0},function(M){return Yu(M,K,f)})},U6=function(z,K,f){return om(z,{mode:"readonly",
B1:!0},function(M){return Xo(M,K,f)})},UXo=function(z,K){z=g.a(z.observers);
for(var f=z.next();!f.done;f=z.next())f=f.value,f(K)},ffS=function(){var z,K,f;
return g.n(function(M){if(M.Y==1)return g.Sq(M,2),g.l(M,g.fR(),4);if(M.Y!=2){z=M.S;if(!z||!g.K8()||typeof g.ZT.BroadcastChannel==="undefined")return M.return();K=new TB_;return M.return(new Z7(z,K))}f=g.QI(M);f instanceof Error&&g.sm(f);return M.return()})},za=function(){MI_||(MI_=ffS());
return MI_},pcZ=function(z){var K;
z=(K=z.options)==null?void 0:K.persistenceOption;return z==="ENTITY_PERSISTENCE_OPTION_PERSIST"||z==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},tI1=function(z){var K;
return g.n(function(f){return f.Y==1?g.l(f,za(),2):(K=f.S)?g.l(f,om(K,"readwrite",function(M){for(var p={},t=g.a(z),B=t.next(),v={};!B.done;v={Pc:void 0,Mw:void 0},B=t.next())v.Pc=B.value,v.Pc.entityKey&&pcZ(v.Pc)&&(v.Mw=g.FT(v.Pc.payload),B=void 0,v.Pc.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(B=function(I){return function(){return Fo(M,I.Pc.payload[I.Mw],I.Mw)}}(v)),v.Pc.type==="ENTITY_MUTATION_TYPE_DELETE"&&(B=function(I){return function(){return O6(M,I.Pc.entityKey)}}(v)),v.Pc.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(B=function(I){return function(){return Zrp(M,I.Pc.entityKey,I.Pc.payload[I.Mw],I.Mw)}}(v)),B&&(p[v.Pc.entityKey]=p[v.Pc.entityKey]?p[v.Pc.entityKey].then(B):B()));
return g.ma.all(Object.values(p))}),0):f.return()})},BS4=function(z){var K;
return g.n(function(f){if(f.Y==1){K=z.mutations;if(!K||K.length<=0)return f.return();if(g.tf){var M={type:"ENTITY_LOADED"};K!==void 0&&(M.payload=K);g.tf.dispatch(M)}return g.l(f,tI1(K),2)}K.length=0;g.Rv(f)})},NS7=function(z){return z!==void 0},vVf=function(z){var K=g.JX();
K=Object.assign({},K);z=Object.assign({},z);for(var f in K)z[f]?(K[f]!==4&&(K[f]=z[f]),delete z[f]):K[f]!==2&&(K[f]=4);Object.assign(K,z);g.aI5(K);JSON.stringify(K);return K},IfS=function(z){var K,f;
return g.n(function(M){if(M.Y==1)return g.l(M,g.fR(),2);if(M.Y!=3)return(K=M.S)?g.l(M,g.dA(K),3):M.return();f=M.S;return M.return(g.iN(f,["index","media","captions"],{mode:"readwrite",B1:!0},function(p){var t=IDBKeyRange.bound(z+"|",z+"~");p=[p.objectStore("index").delete(t),p.objectStore("media").delete(t),p.objectStore("captions").delete(t)];return g.ma.all(p).then(function(){})}))})},Gh5=function(){var z,K;
return g.n(function(f){if(f.Y==1)return g.l(f,g.fR(),2);if(f.Y!=3){z=f.S;if(!z)throw g.Ql("rvdfd");return g.l(f,g.dA(z),3)}K=f.S;return f.return(g.iN(K,["index","media"],{mode:"readwrite",B1:!0},function(M){var p={};return g.jO(M.objectStore("index"),{},function(t){var B=t.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),v=g.ma.resolve(void 0);if(B){var I=B[1];B=B[2];p[I]=p[I]||{};var G;p[I][B]=g.EPv((G=t.getValue())==null?void 0:G.fmts)}else v=t.delete().then(function(){});
return g.ma.all([g.Yi(t),v]).then(function(b){return g.a(b).next().value})}).then(function(){for(var t={},B=g.a(Object.keys(p)),v=B.next();!v.done;v=B.next()){v=v.value;
var I=p[v].v;t[v]=p[v].a&&I?1:2}var G=vVf(t);return g.q8v(M.objectStore("media"),{},function(b){var e=b.cursor.key.match(g.qF8);e&&t[e[1]]||M.objectStore("media").delete(b.cursor.key);return g.azv(b)}).then(function(){return G})})}))})},bV5=function(z,K){var f,M;
return g.n(function(p){if(p.Y==1)return g.l(p,g.fR(),2);if(p.Y!=3){f=p.S;if(!f)throw g.Ql("wct");return g.l(p,g.dA(f),3)}M=p.S;return g.l(p,g.iN(M,["captions"],{mode:"readwrite",B1:!0},function(t){var B=[];t=t.objectStore("captions");for(var v=0;v<K.length;v++){var I=g.dg(t,K[v],z+"|"+K[v].metadata.vss_id);B.push(I)}return g.ma.all(B)}),0)})},eE5=function(z){var K,f,M;
return g.n(function(p){if(p.Y==1)return K=IDBKeyRange.bound(z+"|",z+"~"),g.l(p,g.fR(),2);if(p.Y!=3){f=p.S;if(!f)throw g.Ql("gactfv");return g.l(p,g.dA(f),3)}M=p.S;return p.return(M.getAll("captions",K))})},wc8=function(z){return g.n(function(K){g.i1(z,0);
return K.return(IfS(z))})},DYZ=function(z){return{context:g.tE(),
videoIds:z}},ym5=function(z){return{context:g.tE(),
playlistIds:z}},khp=function(z){return{context:g.tE(),
offlinePlaylistSyncChecks:z}},hEp=function(){this.S=new Map},RE2=function(){af1||(af1=new hEp);
return af1},SE9=function(z,K){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:z},metadata:K,statusCode:void 0,csn:void 0,can:void 0}},uWZ=function(z,K,f){if(!f){var M=M===void 0?!1:M;
f=z.S.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!f||M)f=g.q1(16),z.S.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",f)}z={flowNonce:f,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:K.eventType};K.metadata&&(z.flowMetadata=K.metadata);K.statusCode!==void 0&&(z.flowEventStatus=K.statusCode);K.csn&&(z.csn=K.csn);K.can&&(z.can=K.can);g.Ds("flowEvent",z,void 0)},LVT=function(z){var K,f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u,N8,rZ,LL;
return g.n(function(VQ){if(VQ.Y==1)return g.l(VQ,om(z,{mode:"readonly",B1:!0},function(wZ){return Xo(wZ,"playbackData").then(function(jq){var i_=jq.map(function(m){return m.transfer}).filter(function(m){return!!m}),n1=jq.map(function(m){return m.offlineVideoPolicy}).filter(function(m){return!!m}),H=jq.filter(function(m){return!!m.key}).map(function(m){return g.NA(g.B_(m.key).entityId,"downloadStatusEntity")});
i_=Xo(wZ,"transfer",i_);n1=Xo(wZ,"offlineVideoPolicy",n1);H=Xo(wZ,"downloadStatusEntity",H);var Q=i_.then(function(m){m=m.reduce(function(W,Y){(Y==null?0:Y.offlineVideoStreams)&&W.push.apply(W,g.P(Y.offlineVideoStreams));return W},[]).filter(function(W){return!!W});
return Xo(wZ,"offlineVideoStreams",m)});
return g.ma.all([i_,n1,Q,H]).then(function(m){var W=g.a(m);m=W.next().value;var Y=W.next().value;var LW=W.next().value;W=W.next().value;return[jq,m,Y,LW,W]})})}),2);
if(VQ.Y!=3)return K=VQ.S,g.l(VQ,om(z,{mode:"readonly",B1:!0},function(wZ){return Xo(wZ,"mainDownloadsListEntity").then(function(jq){var i_,n1;return(n1=(i_=jq[0])==null?void 0:i_.downloads)!=null?n1:[]})}),3);
f=VQ.S;M=g.a(K);p=M.next().value;t=M.next().value;B=M.next().value;v=M.next().value;I=M.next().value;G=p;b=t;e=B;w=v;D=I;y={};R={};S={};E={};L={};q=[];V=g.a(b);for(c=V.next();!c.done;c=V.next())(O=c.value)&&(y[O.key]=O);x=g.a(e);for(T=x.next();!T.done;T=x.next())(M8=T.value)&&(R[M8.key]=M8);$S=g.a(D);for(td=$S.next();!td.done;td=$S.next())(r=td.value)&&(S[r.key]=r);yI=g.a(w);for(H5=yI.next();!H5.done;H5=yI.next())(ra=H5.value)&&(E[ra.key]=ra);Ho=g.a(f);for(I8=Ho.next();!I8.done;I8=Ho.next())q8=I8.value,
P5=void 0,L[(P5=q8.videoItem)!=null?P5:""]=!0,q8.videoItem&&(u=t2=void 0,N8=(u=(t2=g.B_(q8.videoItem))==null?void 0:t2.entityId)!=null?u:"",q.push({externalVideoId:N8}));rZ=G.filter(function(wZ){if(!wZ||!wZ.key||!wZ.offlineVideoPolicy)return!1;wZ=g.B_(wZ.key).entityId;wZ=g.NA(wZ,"downloadStatusEntity");var jq;return!(wZ&&((jq=S[wZ])==null?void 0:jq.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
LL=rZ.map(function(wZ){var jq=y[wZ.transfer],i_=[];if(jq==null?0:jq.offlineVideoStreams)for(var n1=g.a(jq.offlineVideoStreams),H=n1.next();!H.done;H=n1.next())(H=E[H.value])&&i_.push(H);n1=R[wZ.offlineVideoPolicy];H=L;var Q=wZ==null?void 0:wZ.playerResponseTimestamp,m=g.B_(n1.key).entityId;wZ=g.NA(m,"mainVideoEntity");if(n1.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var W="OFFLINE_VIDEO_STATE_DISABLED";n1.expirationTimestamp&&Number(n1.expirationTimestamp)<Date.now()/1E3&&(W="OFFLINE_VIDEO_STATE_EXPIRED")}else if(n1.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")W="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(jq==null?void 0:jq.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":W="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":W="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":W="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":W="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":W="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":W="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:W="OFFLINE_VIDEO_STATE_UNKNOWN"}if(W==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(jq==null?void 0:jq.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":W="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":W="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":W=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}m={id:m,videoState:W};if(jq==null?0:jq.cotn)m.cotn=jq.cotn;if(jq==null?0:jq.maximumDownloadQuality)m.selectedVideoQuality=jq==null?void 0:jq.maximumDownloadQuality;if(jq==null?0:jq.lastProgressTimeMs)m.lastProgressTimeMs=jq.lastProgressTimeMs;Q&&(m.playerResponseSavedTimeMs=String(Number(Q)*1E3));jq=String;Q=0;i_=g.a(i_);for(W=i_.next();!W.done;W=i_.next())if(W=W.value,W.streamsProgress){W=g.a(W.streamsProgress);for(var Y=W.next();!Y.done;Y=W.next()){var LW=void 0;
Q+=Number((LW=Y.value.numBytesDownloaded)!=null?LW:0)}}m.downloadedBytes=jq(Q);m.selectedOfflineMode=H[wZ]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";n1.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(m.offlinePlaybackDisabledReason=n1.offlinePlaybackDisabledReason);return m});
return VQ.return({offlineVideos:LL,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:q}}})})},EVH=function(){this.locks=navigator.locks},PA7=function(){try{var z=g.CW("ytglobal.locks_");
if(z)return z;var K;if(K=navigator){var f=navigator;K="locks"in f&&!!f.locks}if(K)return g.ZT.localStorage&&g.ZT.localStorage.getItem("noop"),z=new EVH,g.ov("ytglobal.locks_",z),z}catch(M){}},KA=function(){},HV_=function(){},Qif=function(z){if(z.includes(":"))throw Error("Invalid user cache name: "+z);
return z+":"+g.zN("CacheStorage get")},qE_=function(){return g.n(function(z){if($_!==void 0)return z.return($_);
$_=new Promise(function(K){var f;return g.n(function(M){switch(M.Y){case 1:return g.Sq(M,2),g.l(M,fA.open("test-only"),4);case 4:return g.l(M,fA.delete("test-only"),5);case 5:g.Eu(M,3);break;case 2:if(f=g.QI(M),f instanceof Error&&f.name==="SecurityError")return K(!1),M.return();case 3:K("caches"in window),g.Rv(M)}})});
return z.return($_)})},lff=function(){return g.n(function(z){if(z.Y==1)return g.l(z,qE_(),2);
if(!z.S)return z.return(void 0);mY9||(mY9=new HV_);return z.return(mY9)})},Ml=function(z,K,f){g.Al(new g.UT("Woffle: "+z,f?{cotn:f}:""));
K instanceof Error&&g.Al(K)},VIQ=function(z){var K;
return g.n(function(f){if(f.Y==1)return g.l(f,LVT(z),2);K=f.S;g.Ds("offlineStateSnapshot",K);g.Rv(f)})},pA=function(z){g.J.call(this);
var K=this;this.api=z;this.dO={sP1:function(){return K.S},
nXa:function(){return K.Y}};
typeof g.ZT.BroadcastChannel!=="undefined"&&(this.S=new g.ZT.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.zN()),this.S.onmessage=this.T.bind(this),this.Y=new g.ZT.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.zN()),this.Y.onmessage=this.J.bind(this))},te=function(z,K){z.api.LH("onOfflineOperationFailure",K);
var f;(f=z.S)==null||f.postMessage(K)},nVZ=function(z,K,f,M){var p=this;
this.D=z;this.N=K;this.visibility=f;this.B=M;this.C=this.G=this.W=this.T=this.S=!1;this.J=new g.Kl(function(){p.Mj()});
this.dO={v4:function(){return p.Y},
Mj:function(){p.Mj()},
h$e:function(){return p.J}};
this.visibility.subscribe("visibilitystatechange",function(){p.oX()})},WVZ=function(z){if(!z.T&&!z.S){var K=PA7();
if(K){z.T=!0;var f=g.zN("OfflineLockManager");K.request("woffle_orchestration_leader:"+f,{},function(){var M,p,t,B;return g.n(function(v){switch(v.Y){case 1:return g.Sq(v,2),z.Y=new g.ai,z.S=!0,z.T=!1,g.l(v,z.D(),4);case 4:return g.l(v,z.Y.promise,5);case 5:g.Eu(v,0);break;case 2:M=g.QI(v),((t=(p=z).B)==null?0:t.call(p,"wo_relinquish_leadership_on_lock_request_error"))||z.Mj(),M instanceof Error&&(B=M,B.args=[{name:"WoLockManagerError",n_:M.name}],g.sm(B)),g.Rv(v)}})})}}},Jm_=function(z){z.S&&(z.C=
!0,BV(z))},gVT=function(z,K){z.S&&(z.W=K,BV(z))},iVf=function(z,K){z.S&&(z.G=K,BV(z))},BV=function(z){z.G&&z.W&&z.C&&z.visibility.isBackground()?g.$4(z.J,6E4):z.J.stop()},Nl=function(z){var K;
z.offlineDeleteReason=(K=z.offlineDeleteReason)!=null?K:"OFFLINE_DELETE_REASON_UNKNOWN";var f;z.offlineModeType=(f=z.offlineModeType)!=null?f:"OFFLINE_NOW";g.Ds("offlineDeleteEvent",z)},vV=function(z,K){var f=K.videoId;
var M=K.MC;K=K.offlineModeType;z.encryptedVideoId=f;z.cotn=M==null?void 0:M.cotn;z.offlineabilityFormatType=M==null?void 0:M.maximumDownloadQuality;var p;z.isRefresh=(p=M==null?void 0:M.isRefresh)!=null?p:!1;var t;z.softErrorCount=(t=M==null?void 0:M.transferRetryCount)!=null?t:0;z.offlineModeType=K!=null?K:"OFFLINE_NOW";(z.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&z.statusType==="UNKNOWN_STATUS_TYPE"||!z.transferStatusType&&!z.statusType)&&g.Al(Error("Woffle unknown transfer status"));
g.Ds("offlineTransferStatusChanged",z)},dY7=function(z){vV({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},z)},cmH=function(z,K,f,M){M={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!M};K&&f&&(K=Math.floor(K/1024).toFixed(),f=Math.floor(f/1024).toFixed(),M.alreadyDownloadedKbytes=K,M.totalFetchedKbytes=K,M.totalContentKbytes=f);vV(M,z)},siZ=function(z){vV({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},z)},Am1=function(z){vV({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},z)},jiS=function(z){switch(z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Ig=function(z){var K,f,M;
return((M=(K=z.actionMetadata)==null?void 0:(f=K.retryScheduleIntervalsInSeconds)==null?void 0:f.length)!=null?M:0)>0},Ga=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!z.entityKey},b7=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!z.entityKey},eM=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!z.entityKey},YEQ=function(z){return z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!z.entityKey},
wY=function(z,K,f,M,p){p=p===void 0?!1:p;
var t,B,v,I,G,b;return g.n(function(e){if(e.Y==1)return t=g.NA(z,K),B=g.NA(z,"downloadStatusEntity"),g.l(e,om(f,{mode:"readonly",B1:!0},function(w){return g.ma.all([Yu(w,t,K),Yu(w,B,"downloadStatusEntity")])}),2);
v=e.S;I=v.length?v[0]:void 0;if(!I)return e.jV(0);G=Xc7;if(b=v.length>1?v[1]:void 0){if(b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!p)return e.return();b.downloadState=M}else b={key:B,downloadState:M};g.Om(I,G,b);return g.l(e,om(f,{mode:"readwrite",B1:!0},function(w){return g.ma.all([Fo(w,I,K),Fo(w,b,"downloadStatusEntity")])}),0)})},D_=function(z,K){return z.actionType===K.actionType&&z.entityKey===K.entityKey},yG=function(z,K){if(z&&z.transferState!=="TRANSFER_STATE_COMPLETE"&&z.transferState!==
"TRANSFER_STATE_FAILED"){var f=g.B_(z.key).entityId;
vV({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:f,MC:z,offlineModeType:K})}},k_=function(z){if(!z||!z.thumbnails)return[];
var K=[];z=g.a(z.thumbnails);for(var f=z.next();!f.done;f=z.next())f=f.value,f.url&&K.push(f.url);return K},xYH=function(z,K,f){f=f===void 0?[]:f;
var M,p,t,B,v,I,G,b,e,w,D,y,R;return g.n(function(S){if(S.Y==1)return f.length?g.l(S,U6(z,K),2):S.return([]);M=S.S;p=new Set;t=g.a(M);for(B=t.next();!B.done;B=t.next())if(v=B.value,I=v.id||v.key)G=g.B_(I).entityId,p.add(G);b=[];e=g.a(f);for(w=e.next();!w.done;w=e.next())D=w.value,y=D.offlineVideoData,R=void 0,((R=y)==null?0:R.videoId)&&!p.has(y.videoId)&&b.push(D);return S.return(b)})},FVS=function(z,K,f){return new g.oB(z,{cotn:K,
raw_player_response:f,download_media:!0,start:Infinity,disable_watch_next:!0})},OV_=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},he=function(z,K,f,M,p,t,B,v,I,G,b){this.entityType=z;
this.actionId=K;this.action=f;this.parentActionId=M;this.rootActionId=p===void 0?K:p;this.childActionIds=t;this.prereqActionId=B;this.postreqActionIds=v;this.hasChildActionFailed=G;this.retryScheduleIndex=0;this.S=b||Date.now();this.retryScheduleIndex=I||0},ag=function(z){if(!z.key)throw Error("Entity key is required.");
if(!z.actionProto)throw Error("OfflineOrchestrationAction is required.");var K=g.B_(z.key),f=g.B_(z.actionProto.entityKey);return new he(f.entityType,K.entityId,z.actionProto,z.parentActionId,z.rootActionId,z.childActionIds,z.prereqActionId,z.postreqActionIds,z.retryScheduleIndex,z.hasChildActionFailed,Number(z.enqueueTimeSec)*1E3)},Rg=function(z){return{key:g.NA(z.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:z.action,parentActionId:z.parentActionId,rootActionId:z.rootActionId,childActionIds:z.childActionIds,prereqActionId:z.prereqActionId,postreqActionIds:z.postreqActionIds,retryScheduleIndex:z.retryScheduleIndex,hasChildActionFailed:z.hasChildActionFailed,enqueueTimeSec:(z.S/1E3).toFixed()}},rm7=function(){var z;
return g.n(function(K){return K.Y==1?g.l(K,lff(),2):(z=K.S)?K.return(z.delete("yt-player-local-img")):K.return(!0)})},SM=function(z){var K,f;
return g.n(function(M){if(M.Y==1)return g.l(M,lff(),2);if(M.Y!=3){K=M.S;if(!K)throw Error("Cache API not supported");return z.length?g.l(M,K.open("yt-player-local-img"),3):M.return()}f=M.S;return g.l(M,Promise.all(z.map(function(p){return f.delete(p)})),0)})},u7=function(z){var K,f;
return g.n(function(M){if(M.Y==1)return g.l(M,lff(),2);if(M.Y!=3){K=M.S;if(!K)throw Error("Cache API not supported");return z.length?g.l(M,K.open("yt-player-local-img"),3):M.return()}f=M.S;return g.l(M,f.addAll(z),0)})},LA=function(z,K,f,M,p){var t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5;
return g.n(function(t2){switch(t2.Y){case 1:return t=g.NA(z,"mainVideoEntity"),B=g.NA(z,"ytMainChannelEntity"),v=g.NA(z,"transfer"),I=g.NA(z,"videoDownloadContextEntity"),g.l(t2,om(K,{mode:"readonly",B1:!0},function(u){return g.ma.all([Yu(u,t,"mainVideoEntity"),Yu(u,B,"ytMainChannelEntity"),Yu(u,v,"transfer"),Yu(u,I,"videoDownloadContextEntity"),Xo(u,"ytMainChannelEntity"),Xo(u,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=t2.S;b=g.a(G);e=b.next().value;w=b.next().value;D=b.next().value;y=b.next().value;R=b.next().value;S=b.next().value;E=e;L=w;q=D;V=y;c=R;O=S;if(!E&&!L){t2.jV(3);break}x=E?k_(E.thumbnail):[];if(!L){T=[];t2.jV(4);break}return g.l(t2,ZV2(L,c),5);case 5:T=t2.S;case 4:return M8=T,g.l(t2,SM(x.concat(M8)),3);case 3:$S=[];td=g.NA(z,"downloadStatusEntity");r=g.a(O);for(yI=r.next();!yI.done;yI=r.next())H5=yI.value,ra=g.B_(H5.key).entityId,Ho=ag(H5),I8=g.B_(Ho.action.entityKey).entityId,ra!==z&&I8!==
z||D_(f,H5.actionProto)||$S.push(H5.key);return g.l(t2,om(K,{mode:"readwrite",B1:!0},function(u){var N8=$S.map(function(rZ){return O6(u,rZ)});
N8.push(O6(u,t,{VS:!0}));N8.push(O6(u,td,{VS:!0}));return g.ma.all(N8)}),7);
case 7:P5=(q8=V)==null?void 0:q8.offlineModeType,p&&(Nl(p),p.offlineModeType&&(P5=p.offlineModeType)),yG(q,P5),te(M,{entityKey:t,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Rv(t2)}})},TS9=function(z,K,f,M){var p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u,N8,rZ,LL,VQ,wZ,jq,i_,n1,H,Q,m,W,Y,LW,KW,hd;
return g.n(function(fW){switch(fW.Y){case 1:return p=g.NA(z,"mainPlaylistEntity"),t=g.NA(z,"ytMainChannelEntity"),g.l(fW,om(K,{mode:"readonly",B1:!0},function(l8){return g.ma.all([Yu(l8,p,"mainPlaylistEntity"),Yu(l8,t,"ytMainChannelEntity"),Xo(l8,"mainPlaylistEntity"),Xo(l8,"mainDownloadsListEntity"),Xo(l8,"ytMainChannelEntity"),Xo(l8,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=fW.S;v=g.a(B);I=v.next().value;G=v.next().value;b=v.next().value;e=v.next().value;w=v.next().value;D=v.next().value;y=I;R=G;S=b;E=e;L=w;q=D;if(!y&&!R){fW.jV(3);break}V=y?oVf(y):[];if(!R){c=[];fW.jV(4);break}return g.l(fW,ZV2(R,L),5);case 5:c=fW.S;case 4:return O=c,g.l(fW,SM(V.concat(O)),3);case 3:x=[];T=new Map;if(!y){fW.jV(7);break}return g.l(fW,CAH(y,S,E),8);case 8:x=fW.S;M8=g.a(x);for($S=M8.next();!$S.done;$S=M8.next())td=$S.value,T.set(td,{videoId:td,playlistId:z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.l(fW,om(K,{mode:"readonly",B1:!0},function(l8){return g.ma.all([Xo(l8,"transfer"),Xo(l8,"videoDownloadContextEntity")])}),9);
case 9:r=fW.S;yI=g.a(r);H5=yI.next().value;ra=yI.next().value;Ho=H5;I8=ra;q8=g.a(Ho);for(P5=q8.next();!P5.done;P5=q8.next())t2=P5.value,u=g.B_(t2.key).entityId,(N8=T.get(u))&&t2&&(N8.cotn=t2.cotn);rZ=g.a(I8);for(LL=rZ.next();!LL.done;LL=rZ.next())VQ=LL.value,wZ=g.B_(VQ.key).entityId,(jq=T.get(wZ))&&VQ&&(jq.offlineModeType=VQ.offlineModeType);case 7:i_=[];n1=g.a(q);for(H=n1.next();!H.done;H=n1.next())Q=H.value,m=g.B_(Q.key).entityId,W=ag(Q),m!==z&&W.rootActionId!==z||D_(f,Q.actionProto)||i_.push(Q.key);
Y=g.NA(z,"mainPlaylistEntity");return g.l(fW,om(K,{mode:"readwrite",B1:!0},function(l8){var To=i_.map(function(E9){return O6(l8,E9)});
To.push(O6(l8,Y,{VS:!0}));return g.ma.all(To)}),10);
case 10:if(!y){fW.jV(0);break}x.reverse();if(!x){fW.jV(0);break}LW=g.a(x);KW=LW.next();case 13:if(KW.done){fW.jV(0);break}hd=KW.value;return g.l(fW,LA(hd,K,f,M,T.get(hd)),14);case 14:KW=LW.next(),fW.jV(13)}})},zbZ=function(z,K,f,M){var p,t,B,v,I,G,b,e,w;
return g.n(function(D){if(D.Y==1)return p=g.NA("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),t=new Map,g.l(D,om(z,{mode:"readwrite",B1:!0},function(y){var R=Xo(y,"transfer"),S=Xo(y,"offlineOrchestrationActionWrapperEntity"),E=Xo(y,"videoDownloadContextEntity"),L=Yu(y,p,"mainDownloadsListEntity");return g.ma.all([R,S,E,L]).then(function(q){q=g.a(q);var V=q.next().value;var c=q.next().value;var O=q.next().value;var x=q.next().value;q=UYT.map(function(M8){return r81(y,M8)});
c=g.a(c);for(var T=c.next();!T.done;T=c.next())T=T.value,D_(K,T.actionProto)||q.push(O6(y,T.key,{VS:!0}));x&&(x.downloads=[],q.push(Fo(y,x,"mainDownloadsListEntity")));if(O)for(O=g.a(O),x=O.next();!x.done;x=O.next())x=x.value,c=g.B_(x.key).entityId,c=g.NA(c,"transfer"),t.set(c,x.offlineModeType);return g.ma.all(q).then(function(){return V})})}),2);
B=D.S;v=g.a(B);for(I=v.next();!I.done;I=v.next())G=I.value,yG(G,t.get(G.key)),b=g.B_(G.key).entityId,e={videoId:b,offlineDeleteReason:M,cotn:G.cotn,offlineModeType:t.get(G.key)},Nl(e),w=g.NA(b,"mainVideoEntity"),te(f,{entityKey:w,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(D,rm7(),0)})},oVf=function(z,K){var f=[];
if(z.thumbnailStyleData){z=g.a(z.thumbnailStyleData);for(var M=z.next();!M.done;M=z.next()){var p=void 0,t=void 0,B=void 0;f=f.concat(k_((p=M.value)==null?void 0:(t=p.value)==null?void 0:(B=t.collageThumbnail)==null?void 0:B.coverThumbnail))}}K=k_(K);return f.concat(K)},CAH=function(z,K,f){var M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8;
return g.n(function($S){M=[];p=new Set;if(f.length)for(t=g.a(f),B=t.next();!B.done;B=t.next())if(v=B.value,I=void 0,(I=v.downloads)==null?0:I.length)for(G=g.a(v.downloads),b=G.next();!b.done;b=G.next())e=b.value,e.videoItem&&(w=g.B_(e.videoItem).entityId,p.add(w));if(z.videos){D=g.a(z.videos);for(y=D.next();!y.done;y=D.next())R=y.value,S=JSON.parse(g.B_(R).entityId),S.videoId&&!p.has(S.videoId)&&M.push(S.videoId);E=g.a(K);for(L=E.next();!L.done;L=E.next())if(q=L.value,q.key!==z.key&&(V=q.videos))for(c=
g.a(V),O=c.next();!O.done;O=c.next())x=O.value,T=JSON.parse(g.B_(x).entityId),T.videoId&&(M8=M.indexOf(T.videoId),M8!==-1&&M.splice(M8,1))}return $S.return(M)})},ZV2=function(z,K){var f,M,p,t,B,v,I,G;
return g.n(function(b){f=k_(z.avatar);M=g.a(K);for(p=M.next();!p.done;p=M.next())if(t=p.value,t.id!==z.id)for(B=g.a(k_(t.avatar)),v=B.next();!v.done;v=B.next())I=v.value,G=f.indexOf(I),G!==-1&&f.splice(G,1);return b.return(f)})},KiQ=function(z){var K;
return g.n(function(f){K=g.A(z.frameworkUpdates,E_);return z.frameworkUpdates&&K?g.l(f,BS4(K),0):f.return()})},fV7=function(z){var K;
if((K=z.onResponseReceivedActions)!=null&&K.length){var f;z=(f=g.A(g.A(z.onResponseReceivedActions[0],$c_),g.eFS))==null?void 0:f.actions;if(z!=null&&z.length)return z}},MP9=function(z){var K,f,M;
return g.n(function(p){if(p.Y==1)return z?g.l(p,TY(z,g.i9,"mainDownloadsListEntity"),2):p.return([]);K=p.S;return((f=K)==null?0:(M=f.downloads)==null?0:M.length)?p.return(K.downloads.map(function(t){var B;return(B=t.videoItem)!=null?B:""})):p.return([])})},tPS=function(z,K){var f;
return g.n(function(M){return M.Y==1?g.l(M,px5(z,K),2):(f=M.S)?g.l(M,om(z,{mode:"readwrite",B1:!0},function(p){var t=[Fo(p,f.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];f.mainDownloadsListEntity&&t.push(Fo(p,f.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.ma.all(t)}),0):M.jV(0)})},px5=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q;
return g.n(function(V){if(V.Y==1)return f=g.NA("main_downloads_library_id","mainDownloadsLibraryEntity"),M=g.NA("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(V,om(z,{mode:"readonly",B1:!0},function(c){return g.ma.all([Yu(c,f,"mainDownloadsLibraryEntity"),Yu(c,M,"mainDownloadsListEntity")])}),2);
p=V.S;t=g.a(p);B=t.next().value;v=t.next().value;I=B;G=v;I||(I={id:f});b=g.a(K);for(e=b.next();!e.done;e=b.next())if(w=e.value,w===g.i9){if(I.smartDownloadsList)return V.return();I.smartDownloadsList=w}else if(D=g.B_(w).entityType,y={},D==="mainPlaylistEntity"?y.playlistItem=w:D==="mainVideoEntity"&&(y.videoItem=w),!g.U9(y)){R=void 0;if((R=G)==null?0:R.downloads){S=!1;E=g.a(G.downloads);for(L=E.next();!L.done;L=E.next())if(q=L.value,q.playlistItem===w||q.videoItem===w){S=!0;break}S||G.downloads.push(y)}else G=
{id:M,downloads:[y]};I.downloadsList=M}return V.return({mainDownloadsLibraryEntity:I,mainDownloadsListEntity:G})})},BhT=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S;
return g.n(function(E){if(E.Y==1)return f=g.NA("main_downloads_library_id","mainDownloadsLibraryEntity"),M=g.NA("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(E,om(z,{mode:"readonly",B1:!0},function(L){return g.ma.all([Yu(L,f,"mainDownloadsLibraryEntity"),Yu(L,M,"mainDownloadsListEntity"),Yu(L,g.i9,"mainDownloadsListEntity")])}),2);
p=E.S;t=g.a(p);B=t.next().value;v=t.next().value;I=t.next().value;G=B;b=v;e=I;if(!G)return E.jV(0);if(K===g.i9&&((w=e)==null?0:w.downloads))e.downloads=[];else if((D=b)==null?0:D.downloads)for(y=g.B_(K).entityType,R=0;R<b.downloads.length;R++)if(S=b.downloads[R],y==="mainVideoEntity"&&S.videoItem===K){b.downloads.splice(R,1);break}else if(y==="mainPlaylistEntity"&&S.playlistItem===K){b.downloads.splice(R,1);break}return g.l(E,om(z,{mode:"readwrite",B1:!0},function(L){var q=[Fo(L,G,"mainDownloadsLibraryEntity")];
b&&q.push(Fo(L,b,"mainDownloadsListEntity"));e&&q.push(Fo(L,e,"mainDownloadsListEntity"));return g.ma.all(q)}),0)})},PV=function(z,K){var f,M,p,t,B,v,I,G,b,e,w;
return g.n(function(D){if(D.Y==1)return f=g.NA(K,"transfer"),M=g.NA(K,"videoDownloadContextEntity"),g.l(D,om(z,{mode:"readonly",B1:!0},function(y){return g.ma.all([Yu(y,f,"transfer"),Yu(y,M,"videoDownloadContextEntity")])}),2);
p=D.S;t=g.a(p);B=t.next().value;v=t.next().value;I=B;G=v;w={videoId:K,cotn:(b=I)==null?void 0:b.cotn,offlineModeType:(e=G)==null?void 0:e.offlineModeType};return D.return(w)})},HV=function(z,K,f,M,p){var t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T;
return g.n(function(M8){switch(M8.Y){case 1:return t=g.NA(z,"musicTrack"),B=g.NA(z,"transfer"),g.l(M8,om(K,{mode:"readonly",B1:!0},function($S){return g.ma.all([Yu($S,t,"musicTrack"),Yu($S,B,"transfer"),Xo($S,"musicTrack"),Xo($S,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=M8.S;I=g.a(v);G=I.next().value;b=I.next().value;e=I.next().value;w=I.next().value;D=G;y=b;R=e;S=w;if(!D){M8.jV(3);break}return g.l(M8,Nh4(D,R),4);case 4:return E=M8.S,g.l(M8,SM(E),3);case 3:L=[];q=g.a(S);for(V=q.next();!V.done;V=q.next())c=V.value,O=g.B_(c.key).entityId,x=ag(c),T=g.B_(x.action.entityKey).entityId,O!==z&&T!==z||D_(f,c.actionProto)||L.push(c.key);return g.l(M8,om(K,{mode:"readwrite",B1:!0},function($S){var td=L.map(function(r){return O6($S,r)});
td.push(O6($S,t,{VS:!0}));return g.ma.all(td)}),6);
case 6:yG(y),p&&Nl(p),te(M,{entityKey:t,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Rv(M8)}})},QG=function(z,K,f,M,p){var t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u,N8,rZ,LL;
return g.n(function(VQ){switch(VQ.Y){case 1:return t=g.NA(z,K),B=g.NA("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(VQ,om(f,{mode:"readonly",B1:!0},function(wZ){return g.ma.all([Yu(wZ,t,K),Yu(wZ,B,"musicDownloadsLibraryEntity"),Xo(wZ,K),Xo(wZ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=VQ.S;I=g.a(v);G=I.next().value;b=I.next().value;e=I.next().value;w=I.next().value;D=G;y=b;R=e;S=w;if(!D){VQ.jV(3);break}return g.l(VQ,Nh4(D,R),4);case 4:return E=VQ.S,g.l(VQ,SM(E),3);case 3:L=[];q=new Map;if(!D){VQ.jV(6);break}return g.l(VQ,vn7(D,R,y),7);case 7:L=VQ.S;V=g.a(L);for(c=V.next();!c.done;c=V.next())O=c.value,x=g.B_(O).entityId,q.set(x,{videoId:x,playlistId:z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.l(VQ,U6(f,"transfer"),8);case 8:for(T=VQ.S,M8=
g.a(T),$S=M8.next();!$S.done;$S=M8.next())td=$S.value,r=g.B_(td.key).entityId,(yI=q.get(r))&&td&&(yI.cotn=td.cotn);case 6:H5=[];ra=g.a(S);for(Ho=ra.next();!Ho.done;Ho=ra.next())I8=Ho.value,q8=g.B_(I8.key).entityId,P5=ag(I8),q8!==z&&P5.rootActionId!==z||D_(M,I8.actionProto)||H5.push(I8.key);t2=g.NA(z,K);return g.l(VQ,om(f,{mode:"readwrite",B1:!0},function(wZ){var jq=H5.map(function(i_){return O6(wZ,i_)});
jq.push(O6(wZ,t2,{VS:!0}));return g.ma.all(jq)}),9);
case 9:if(!D){VQ.jV(0);break}L.reverse();if(!L.length){VQ.jV(0);break}u=g.a(L);N8=u.next();case 12:if(N8.done){VQ.jV(0);break}rZ=N8.value;LL=g.B_(rZ).entityId;if(!LL){VQ.jV(13);break}return g.l(VQ,HV(LL,f,M,p,q.get(LL)),13);case 13:N8=u.next(),VQ.jV(12)}})},ql=function(z,K,f){var M,p,t,B,v,I,G;
return g.n(function(b){if(b.Y==1)return g.l(b,om(z,{mode:"readwrite",B1:!0},function(e){var w=Xo(e,"transfer"),D=Xo(e,"offlineOrchestrationActionWrapperEntity");return g.ma.all([w,D]).then(function(y){y=g.a(y);var R=y.next().value;var S=y.next().value;y=IV9.map(function(V){return r81(e,V)});
S=g.a(S);for(var E=S.next();!E.done;E=S.next()){E=E.value;var L=g.B_(E.actionProto.entityKey).entityType==="musicTrack",q=E.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";D_(K,E.actionProto)||L&&(!L||q)||y.push(O6(e,E.key,{VS:!0}))}return g.ma.all(y).then(function(){return R})})}),2);
M=b.S;p=g.a(M);for(t=p.next();!t.done;t=p.next())B=t.value,yG(B),v=g.B_(B.key).entityId,I={videoId:v,offlineDeleteReason:void 0,cotn:B.cotn},Nl(I),G=g.NA(v,"musicTrack"),te(f,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(b,rm7(),0)})},G$Q=function(z){for(var K,f=g.a(z.additionalMetadatas),M=f.next();!M.done;M=f.next())M=M.value,M.offlineMusicVideoData&&(K=M.offlineMusicVideoData);
var p,t,B,v,I;return{id:g.NA(z.videoId,"musicTrack"),videoId:z.videoId,title:z.title,thumbnailDetails:z.thumbnail,lengthMs:String(Number(z.lengthSeconds)*1E3),albumTitle:(p=K)==null?void 0:p.releaseTitle,musicVideoType:(t=K)==null?void 0:t.musicVideoType,contentRating:{explicitType:(B=K)==null?void 0:B.explicitType},artistNames:((v=K)==null?void 0:v.byline)||((I=K)==null?void 0:I.channelName),downloadMetadata:g.NA(z.videoId,"musicTrackDownloadMetadataEntity")}},vn7=function(z,K,f){var M,p,t,B,v,I,
G,b,e,w,D,y,R,S,E,L,q,V;
return g.n(function(c){M=[];p=new Set;if((t=f)==null?0:(B=t.downloadedTracks)==null?0:B.length)for(v=g.a(f.downloadedTracks),I=v.next();!I.done;I=v.next())G=I.value,p.add(G);if(z.tracks){b=g.a(z.tracks);for(e=b.next();!e.done;e=b.next())w=e.value,p.has(w)||M.push(w);D=g.a(K);for(y=D.next();!y.done;y=D.next())if(R=y.value,R.id!==z.id&&(S=R.tracks))for(E=g.a(S),L=E.next();!L.done;L=E.next())q=L.value,V=M.indexOf(q),V!==-1&&M.splice(V,1)}return c.return(M)})},Nh4=function(z,K){var f,M,p,t,B,v,I,G;
return g.n(function(b){f=k_(z.thumbnailDetails);M=g.a(K);for(p=M.next();!p.done;p=M.next())if(t=p.value,t.id!==z.id)for(B=g.a(k_(t.thumbnailDetails)),v=B.next();!v.done;v=B.next())I=v.value,G=f.indexOf(I),G!==-1&&f.splice(G,1);return b.return(f)})},bG8=function(z,K){var f,M,p,t,B,v,I,G,b;
return g.n(function(e){if(e.Y==1)return f=g.NA("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(e,TY(z,f,"musicDownloadsLibraryEntity"),2);(M=e.S)||(M={id:f});p=g.B_(K).entityType;p==="musicTrack"?(t=M.downloadedTracks)!=null&&t.includes(K)||(M.downloadedTracks=((B=M.downloadedTracks)!=null?B:[]).concat(K)):p==="musicPlaylist"?(v=M.downloadedPlaylists)!=null&&v.includes(K)||(M.downloadedPlaylists=((I=M.downloadedPlaylists)!=null?I:[]).concat(K)):p!=="musicAlbumRelease"||(G=M.downloadedAlbumReleases)!=
null&&G.includes(K)||(M.downloadedAlbumReleases=((b=M.downloadedAlbumReleases)!=null?b:[]).concat(K));return g.l(e,C4(z,M,"musicDownloadsLibraryEntity"),0)})},ebZ=function(z,K){var f,M,p,t,B,v,I;
return g.n(function(G){if(G.Y==1)return f=g.NA("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(G,TY(z,f,"musicDownloadsLibraryEntity"),2);M=G.S;if(!M)return G.jV(0);p=g.B_(K).entityType;p==="musicTrack"?t=M.downloadedTracks:p==="musicPlaylist"&&(t=M.downloadedPlaylists);if((B=t)==null?0:B.length)for(v=0;v<t.length;v++)if(I=t[v],I===K){t.splice(v,1);break}return g.l(G,C4(z,M,"musicDownloadsLibraryEntity"),0)})},wxo=function(z){var K=z.videos;
z=[];var f=[];if(K){K=g.a(K);for(var M=K.next();!M.done;M=K.next()){var p=M.value.offlineVideoData.videoId;M=g.NA(p,"musicTrack");p=g.NA(p,"musicTrackDownloadMetadataEntity");z.push(M);f.push(p)}}return{DB:z,Xn:f}},mq=function(z,K,f){K={track:G$Q(K)};
f&&(K.playlistId=f);if(z=g.A(z.actionMetadata,Dc4))K.maximumDownloadQuality=z.maximumDownloadQuality;return{musicTrackEntityActionMetadata:K}},k$H=function(z){var K,f,M,p,t,B,v,I;
return g.n(function(G){switch(G.Y){case 1:return K=g.eh(),f=DYZ(z),M=g.aV(yy_),g.Sq(G,2),t={vX:!0},g.l(G,g.$H(K,f,M,void 0,t),4);case 4:p=G.S;g.Eu(G,3);break;case 2:B=g.QI(G);if(B instanceof g.IU)throw v="GetOffline network manager error: "+B.message,Ml(v,B),Error(v);Ml("GetOffline fetch request error",B);throw Error("GetOffline fetch request error");case 3:I=l7(p);if(!p)throw Ml("Network request failed"),Error("Network request failed");if(I!==void 0)VG(I);else if(!p.videos||!p.videos.length)throw Ml("No data"),
Error("No data");return G.return(p.videos.map(function(b){return b.offlineVideoData}))}})},hbQ=function(z){var K,f,M,p,t,B,v,I;
return g.n(function(G){switch(G.Y){case 1:return K=g.eh(),f=ym5(z),M=g.aV(yy_),g.Sq(G,2),t={vX:!0},g.l(G,g.$H(K,f,M,void 0,t),4);case 4:p=G.S;g.Eu(G,3);break;case 2:B=g.QI(G);if(B instanceof g.IU)throw v="GetOffline network manager error for playlist: "+B.message,Ml(v,B),Error(v);Ml("GetOffline fetch request error for playlist",B);throw Error("GetOffline fetch request error for playlist");case 3:I=l7(p);if(!p)throw Ml("Network request failed for playlist"),Error("Network request failed for playlist");
if(I!==void 0)VG(I,"playlist");else if(!p.playlists||!p.playlists.length)throw Ml("No data for playlist"),Error("No data for playlist");return G.return(p.playlists.map(function(b){return b.offlinePlaylistData}))}})},Rb_=function(z,K,f,M){var p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8;
return g.n(function(q8){switch(q8.Y){case 1:return g.l(q8,za(),2);case 2:p=q8.S;if(!p)return q8.return([]);t=[];if((B=M)==null?0:B.length){t=M;q8.jV(3);break}return g.l(q8,U6(p,"mainPlaylistEntity"),4);case 4:t=q8.S;case 3:if(!t.length)return q8.return([]);v=[];I=Date.now()/1E3;G=g.a(t);b=G.next();case 5:if(b.done)return v.length?g.l(q8,aV7(v),10):q8.return([]);e=b.value;if(!e.downloadState){w=void 0;q8.jV(8);break}return g.l(q8,TY(p,e.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:w=
q8.S;case 8:D=w;y=void 0;S=(R=(y=e)==null?void 0:y.entityMetadata)&&R.nextAutoRefreshIntervalSeconds?Number(R.nextAutoRefreshIntervalSeconds):NaN;E=Number.isNaN(S)?z:S;q=L=void 0;V=((L=D)==null?0:L.lastSyncedTimestampMillis)?Number((q=D)==null?void 0:q.lastSyncedTimestampMillis)/1E3:0;O=c=void 0;x=((c=D)==null?0:c.addedTimestampMillis)?Number((O=D)==null?void 0:O.addedTimestampMillis)/1E3:0;if(f||!R||V+E<=I){T=[];M8=void 0;if((M8=e.videos)==null?0:M8.length)for($S=g.a(e.videos),td=$S.next();!td.done;td=
$S.next())r=td.value,yI=JSON.parse(g.B_(r).entityId),yI.videoId&&T.push(yI.videoId);H5="0";R&&(ra=void 0,H5=String(Number((ra=R.offlineLastModifiedTimestampSeconds)!=null?ra:0).toFixed()));Ho={playlistId:e.playlistId,videoIds:T,offlineLastModifiedTimestamp:H5,autoSync:K,offlineDateAddedTimestamp:String(x.toFixed())};v.push(Ho)}b=G.next();q8.jV(5);break;case 10:return I8=q8.S,q8.return(I8)}})},SDp=function(){var z,K,f,M,p;
return g.n(function(t){if(t.Y==1)return g.l(t,za(),2);if(t.Y!=3)return(z=t.S)?g.l(t,U6(z,"refresh"),3):t.return(!1);K=t.S;if((f=K[0])==null||!f.refreshTime)return t.return(!1);M=Number(K[0].refreshTime);p=Date.now()/1E3;return t.return(isFinite(M)&&p>=M)})},LiS=function(z,K){var f,M,p;
return g.n(function(t){switch(t.Y){case 1:return g.Sq(t,2),g.l(t,u8H(z,K),4);case 4:return M=t.S,g.l(t,KiQ(M),5);case 5:f=fV7(M);g.Eu(t,3);break;case 2:p=g.QI(t),Ml("getAndProcessSmartDownloadsResponse request or processing error",p);case 3:return t.return(f)}})},Enf=function(z,K,f,M){var p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8;
return g.n(function(q8){switch(q8.Y){case 1:return g.l(q8,za(),2);case 2:p=q8.S;if(!p)return q8.return([]);t=[];if((B=M)==null?0:B.length){t=M;q8.jV(3);break}return g.l(q8,U6(p,"musicPlaylist"),4);case 4:t=q8.S;case 3:if(!t.length)return q8.return([]);v=[];I=Date.now()/1E3;G=g.a(t);b=G.next();case 5:if(b.done)return v.length?g.l(q8,aV7(v),10):q8.return([]);e=b.value;w=void 0;y=(D=(w=e)==null?void 0:w.entityMetadata)&&D.nextAutoRefreshIntervalSeconds?Number(D.nextAutoRefreshIntervalSeconds):NaN;R=
Number.isNaN(y)?z:y;E=S=0;L="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!e.downloadMetadata){q8.jV(8);break}return g.l(q8,TY(p,e.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:q=q8.S,c=V=void 0,S=Number((c=(V=q)==null?void 0:V.addedTimestampMillis)!=null?c:"0")/1E3,x=O=void 0,E=Number((x=(O=q)==null?void 0:O.lastModifiedTimestampMillis)!=null?x:"0")/1E3,M8=T=void 0,L=(M8=(T=q)==null?void 0:T.syncState)!=null?M8:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:$S=void 0;if(f||L!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!D||Number(($S=D.lastSyncedTimestampSeconds)!=null?$S:0)+R<=I){td=[];r=void 0;if((r=e.tracks)==null?0:r.length)for(yI=g.a(e.tracks),H5=yI.next();!H5.done;H5=yI.next())ra=H5.value,td.push(g.B_(ra).entityId);Ho={playlistId:e.playlistId,videoIds:td,offlineLastModifiedTimestamp:String(E.toFixed()),autoSync:K,offlineDateAddedTimestamp:String(S.toFixed())};v.push(Ho)}b=G.next();q8.jV(5);break;case 10:return I8=q8.S,q8.return(I8)}})},u8H=function(z,K){var f,M,p,t,B,v,I,G,b,e;
return g.n(function(w){switch(w.Y){case 1:return f=g.eh(),g.l(w,za(),2);case 2:M=w.S;if(!M){w.jV(3);break}return g.l(w,LVT(M),4);case 4:p=w.S;case 3:var D=p;t={context:g.tE(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:z},offlineClientState:D,clientStateRequestData:{preferredFormatType:K}}}};B=g.aV(P21);g.Sq(w,5);I={vX:!0};return g.l(w,g.$H(f,t,B,void 0,I),7);case 7:v=w.S;g.Eu(w,6);break;case 5:G=g.QI(w);if(G instanceof g.IU)throw b=
"DPS network manager error for smart downloads: "+G.message,Ml(b,G),Error(b);Ml("DPS fetch request error for smart downloads",G);throw Error("DPS fetch request error for smart downloads");case 6:e=l7(v);if(v)e!==void 0&&VG(e,"smart downloads");else throw Ml("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return w.return(v)}})},Ql9=function(z,K){var f,M,p,t,B,v,I,G;
return g.n(function(b){switch(b.Y){case 1:return f=g.eh(),M={context:g.tE(),videoPlaybackPositionEntities:z,lastSyncTimestampUsec:K},p=g.aV(HG1),g.Sq(b,2),B={vX:!0},g.l(b,g.$H(f,M,p,void 0,B),4);case 4:t=b.S;g.Eu(b,3);break;case 2:v=g.QI(b);if(v instanceof g.IU)throw I="VPPS network manager error: "+v.message,Ml(I,v),Error(I);Ml("VPPS fetch request error",v);throw Error("VPPS fetch request error");case 3:G=l7(t);if(t)G!==void 0&&VG(G,"position sync");else throw Ml("Network request failed for position sync"),
Error("Network request failed for position sync");return b.return(t)}})},mcZ=function(z,K,f){var M,p,t,B,v,I,G,b;
return g.n(function(e){switch(e.Y){case 1:M=g.eh();var w=f.refreshData,D=f.isEnqueuedForExpiredStreamUrlRefetch,y=f.Hb,R=f.offlineSourceData,S=f.mediaCapabilities,E={entityKey:z};w&&(E.refreshData=w);D&&(E.isExpiredStreamUrlRefetch=D);y&&(E.downloadParameters=y);R&&(E.offlineSourceData=R);w={context:g.BD(K),signatureTimestamp:20237,videos:[E]};S&&(w.mediaCapabilities=S);p=w;t=g.aV(qDp);g.Sq(e,2);v={vX:!0};return g.l(e,g.$H(M,p,t,void 0,v),4);case 4:B=e.S;g.Eu(e,3);break;case 2:I=g.QI(e);if(I instanceof
g.IU)throw G="GetPDE network manager error: "+I.message,Ml(G,I),Error(G);Ml("GetPDE fetch request error",I);throw Error("GetPDE fetch request error");case 3:b=l7(B);if(B)b!==void 0&&VG(b,"PDE");else throw Ml("Network request failed for PDE"),Error("Network request failed for PDE");return e.return(B)}})},l7=function(z){var K;
return(K=z.errorMetadata)==null?void 0:K.status},VG=function(z,K){K=K?" for "+K:"";
if(z===0)throw z="Empty response body"+K,Ml(z),Error(z);z="Response with error"+K;Ml(z);throw Error(z);},aV7=function(z){var K,f,M,p,t,B,v,I;
return g.n(function(G){switch(G.Y){case 1:return K=g.eh(),f=khp(z),M=g.aV(lV9),g.Sq(G,2),t={vX:!0},g.l(G,g.$H(K,f,M,void 0,t),4);case 4:p=G.S;g.Eu(G,3);break;case 2:B=g.QI(G);if(B instanceof g.IU)throw v="offlinePlaylistSyncCheck network manager error: "+B.message,Ml(v,B),Error(v);Ml("offlinePlaylistSyncCheck fetch request error",B);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:I=l7(p);if(!p)throw Ml("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(I!==void 0)VG(I,"playlist sync");else if(!p.offlinePlaylistSyncCheckDatas||!p.offlinePlaylistSyncCheckDatas.length)throw Ml("No data for playlist sync"),Error("No data for playlist sync");return G.return(p.offlinePlaylistSyncCheckDatas.map(function(b){return b.offlinePlaylistSyncCheckData}))}})},nA=function(z){this.S=z},VPS=function(z,K){var f,M,p,t,B,v;
return g.n(function(I){switch(I.Y){case 1:f=new Map,M=g.a(K),p=M.next();case 2:if(p.done){I.jV(4);break}t=p.value;B=f;v=B.set;return g.l(I,z.Y(t),5);case 5:v.call(B,t,I.S);p=M.next();I.jV(2);break;case 4:return I.return(f)}})},WV=function(z,K,f,M,p,t){K=g.NA(K,f);
M=Object.assign({},t,{priority:M,retryScheduleIntervalsInSeconds:p});return{actionType:z,entityKey:K,actionMetadata:M}},Je=function(z,K,f,M,p,t){this.status=z;
this.S=K;this.J=f;this.Y=M;this.T=p;this.downloadState=t},nn4=function(z,K,f){this.S=z;
this.SV=K;this.T=f},gno=function(z,K){var f,M,p,t,B,v,I,G,b;
return g.n(function(e){switch(e.Y){case 1:return f=K.entityKey,p=(M=g.A(K.actionMetadata,gY))==null?void 0:M.isEnqueuedForExpiredStreamUrlRefetch,g.Sq(e,2),t=void 0,g.l(e,Wio(z,K),4);case 4:t=e.S;g.Sq(e,5);var w=(w=g.A(K.actionMetadata,gY))?{maximumDownloadQuality:w.maximumDownloadQuality}:void 0;return g.l(e,mcZ(f,z.SV,{isEnqueuedForExpiredStreamUrlRefetch:p,Hb:w,offlineSourceData:t}),7);case 7:B=e.S;g.Eu(e,6,2);break;case 5:return g.QI(e,2),v=Ig(K)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Ml("PDE handleAdd error"),e.return(i7(K,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",v,"DOWNLOAD_STATE_FAILED"));case 6:return g.l(e,Jy5(z,B,K),8);case 8:return e.return(i7(K,!0,B.orchestrationActions));case 2:return I=g.QI(e),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.uN&&I.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ml("PDE handleAdd error"),e.return(i7(K,!1,void 0,G,b,"DOWNLOAD_STATE_FAILED"))}})},cyo=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8;
return g.n(function($S){switch($S.Y){case 1:return f=K.entityKey,M=g.B_(f).entityId,g.l($S,om(z.S,{mode:"readonly",B1:!0},function(td){var r=Yu(td,f,"playbackData"),yI=Yu(td,g.NA(M,"offlineVideoPolicy"),"offlineVideoPolicy");td=Yu(td,g.NA(M,"transfer"),"transfer");return g.ma.all([r,yI,td])}),2);
case 2:p=$S.S;t=g.a(p);B=t.next().value;v=t.next().value;I=t.next().value;G=B;b=v;e=I;if(!G||!b)return $S.return(i7(K,!0));w=[];R=((y=G)==null?0:y.playerResponseJson)?JSON.parse(G.playerResponseJson):null;if(!(e&&R&&z.SV.B("html5_refresh_deprecated_downloads"))){$S.jV(3);break}D=iGQ(z,R,e);return g.l($S,dc1(z,e),4);case 4:w=$S.S;case 3:S={lastPlayerResponseTimestampSeconds:G.playerResponseTimestamp,offlineToken:b.offlineToken,formatIds:w};E={};if((L=e)==null?0:L.maximumDownloadQuality)E.maximumDownloadQuality=
e.maximumDownloadQuality;g.Sq($S,5);q=void 0;return g.l($S,Wio(z,K),7);case 7:return q=$S.S,g.Sq($S,8),g.l($S,mcZ(f,z.SV,{refreshData:S,Hb:E,offlineSourceData:q,mediaCapabilities:D}),10);case 10:V=$S.S;g.Eu($S,9,5);break;case 8:return g.QI($S,5),c=Ig(K)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Ml("PDE handleRefresh error"),$S.return(i7(K,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",c,
"DOWNLOAD_STATE_FAILED"));case 9:return g.l($S,Jy5(z,V,K),11);case 11:return $S.return(i7(K,!0,V.orchestrationActions));case 5:return O=g.QI($S),x="PDE handleRefresh error",O instanceof Error&&(x="PDE handleRefresh error: "+O.message),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M8="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.uN&&O.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M8="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Ml(x),$S.return(i7(K,!1,void 0,T,M8,"DOWNLOAD_STATE_FAILED"))}})},Wio=function(z,K){var f,M,p,t;
return g.n(function(B){if(B.Y==1)return f=g.B_(K.entityKey).entityId,M=g.NA(f,"videoDownloadContextEntity"),g.l(B,TY(z.S,M,"videoDownloadContextEntity"),2);p=B.S;return(t=p)!=null&&t.offlineModeType?B.return({offlineModeType:p.offlineModeType}):B.return(void 0)})},Jy5=function(z,K,f){var M,p,t,B,v;
return g.n(function(I){if(I.Y==1){if(!K.frameworkUpdates||!g.A(K.frameworkUpdates,E_))return I.return();if(!(g.A(K.frameworkUpdates,E_).mutations&&g.A(K.frameworkUpdates,E_).mutations.length>0&&g.A(K.frameworkUpdates,E_).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return I.jV(2);M=g.B_(g.A(K.frameworkUpdates,E_).mutations[0].entityKey).entityId;return g.l(I,PV(z.S,M),3)}if(I.Y!=2){p=I.S;t=g.A(f.actionMetadata,gY);if(v=(B=t)==null?void 0:B.playlistId)p.playlistId=v;p.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.$t(z.SV)?g.l(I,LA(M,z.S,f,z.T,p),2):g.O$(z.SV)?g.l(I,HV(M,z.S,f,z.T),2):I.jV(2)}return g.l(I,BS4(g.A(K.frameworkUpdates,E_)),0)})},i7=function(z,K,f,M,p,t){return new Je(K?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Ig(z),f,M,p,t)},iGQ=function(z,K,f){K=FVS(z.SV,f.cotn,K);
f=g.eu(K);return g.Tpo(K,f,z.SV)},dc1=function(z,K){var f,M,p,t,B,v,I,G,b,e,w;
return g.n(function(D){if(D.Y==1)return f=[],g.l(D,om(z.S,{mode:"readonly",B1:!0},function(y){var R=[],S=K.offlineVideoStreams;if(S){S=g.a(S);for(var E=S.next();!E.done;E=S.next())R.push(Yu(y,E.value,"offlineVideoStreams"))}return g.ma.all(R)}),2);
if(M=D.S)for(p=g.a(M),t=p.next();!t.done;t=p.next())if(B=t.value,v=void 0,(v=B)==null?0:v.streamsProgress)for(I=B.streamsProgress,G=0;G<I.length;G++)b=I[G],e=JSON.parse(b.formatStreamBytes),w={itag:e.itag,lmt:e.lastModified,xtags:e.xtags},f.push(w);return D.return(f)})},slf=function(z,K){this.S=z;
this.SV=K},Ayo=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D;
return g.n(function(y){switch(y.Y){case 1:return f=Ig(K),g.l(y,U6(z.S,"videoPlaybackPositionEntity"),2);case 2:M=y.S;if(M.length===0)return y.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.Sq(y,3);return g.l(y,s6.getInstance(),5);case 5:p=y.S;if(!p)throw Error("prefStorage is undefined");return g.l(y,p.get("psi"),6);case 6:return t=y.S,I=(v=(B=t)==null?void 0:B.UQ)!=null?v:"0",g.l(y,Ql9(M,I),7);case 7:return G=y.S,b={isPaused:G.watchHistoryPaused,UQ:G.syncTimestampUsec},g.l(y,p.set("psi",
b),8);case 8:if(b.isPaused){y.jV(9);break}e=g.A(G.frameworkUpdates,E_);if(!G.frameworkUpdates||!e){y.jV(9);break}return g.l(y,BS4(e),9);case 9:g.Eu(y,4);break;case 3:return w=g.QI(y),D="PPE handleRefresh error: "+(w instanceof Error?w.message:"unknown error"),Ml(D),y.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return y.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},YDo=function(z,K){var f,M,p,t,B,v,I,G;
return g.n(function(b){switch(b.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey).entityId,g.Sq(b,2),g.l(b,s6.getInstance(),4);case 4:p=b.S;if(!p)throw Error("prefStorage is undefined");return g.l(b,p.get("psi"),5);case 5:t=b.S;B=g.A(K.actionMetadata,jl1);if(((v=t)==null?void 0:v.isPaused)!==!1||(I=B)==null||!I.lastPlaybackPositionSeconds){b.jV(6);break}G={key:g.NA(M,"videoPlaybackPositionEntity"),videoId:M,lastPlaybackPositionSeconds:B.lastPlaybackPositionSeconds};return g.l(b,C4(z.S,G,"videoPlaybackPositionEntity"),
6);case 6:g.Eu(b,3);break;case 2:return g.QI(b),b.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},Xx1=function(z,K){var f,M,p;
return g.n(function(t){switch(t.Y){case 1:f=Ig(K);g.Sq(t,2);M=g.B_(K.entityKey).entityId;if(M==="!*$_ALL_ENTITIES_!*$")return g.l(t,$YQ(z.S),5);p=g.NA(M,"videoPlaybackPositionEntity");return g.l(t,KVQ(z.S,p),5);case 5:g.Eu(t,3);break;case 2:return g.QI(t),t.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},xcH=function(z,K){this.api=z;
this.S=K;this.logger=new g.Np("woffle");this.Y=!1;this.dO={bK:this.bK};this.logger.debug("Initialized OfflineMediaManager")},FiQ=function(z){return g.n(function(K){return K.return(wc8(z))})},OG_=function(z){var K;
return g.n(function(f){if(f.Y==1)return g.l(f,g.PJp(z),2);K=f.S;return f.return(K.filter(function(M){return!!M.url}).map(function(M){return M.url}))})},dY=function(z,K){var f=g.gA(K);
if(f===1||f===0)return Promise.resolve();(f=ry8(z,K))&&f.stopVideo();z.T=0;return FiQ(K)},cV=function(z,K,f,M){f=f===void 0?!1:f;
M=M===void 0?!0:M;var p=typeof K==="string"?K:K.videoDetails.videoId;g.gA(p)===2&&((K=ry8(z,p))?K.stopVideo():z.logger.info(function(){return"Corresponding player for "+p+" not found. Pausing anyway"}),g.i1(p,2),z.T=2,f?ZGo(z.S):M&&onZ(z.S))},ry8=function(z,K){var f;
return((f=z.player)==null?void 0:f.getVideoData().videoId)===K?z.player:null},C24=function(z,K,f){K.getPlayerResponse();
g.i1(K.videoId,2);z.T=2;z.Y=!1;var M;(M=z.player)==null||M.dispose();z.player=z.api.RQ(K);K={};z.player.Qw((K.localmediachange=z.wA,K.signatureexpired=z.nm,K.statechange=z.niH,K),z);var p=z.bK(f);z.player.T3(g.DJ(p,p,!0,"m"),!1);z.logger.debug(function(){return"Starting headless playback with quality: "+p});
z.player.GK(!1)},Th2=function(z,K){this.S=z;
this.SV=K},z31=function(z,K){var f,M;
return g.n(function(p){switch(p.Y){case 1:return f=Ig(K),g.l(p,TY(z.S,K.entityKey,"transfer"),2);case 2:if(M=p.S)return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.Sq(p,3);return g.l(p,Uc2(z,K),5);case 5:g.Eu(p,4);break;case 3:return g.QI(p),p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},KQf=function(z,K){var f,M;
return g.n(function(p){switch(p.Y){case 1:return f=Ig(K),g.l(p,TY(z.S,K.entityKey,"transfer"),2);case 2:M=p.S;if(!M||M.transferState!=="TRANSFER_STATE_COMPLETE")return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.Sq(p,3);return g.l(p,Uc2(z,K,!0),5);case 5:g.Eu(p,4);break;case 3:return g.QI(p),p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},$i_=function(z,K){var f,M,p,t,B,v,I,G,b,e;
return g.n(function(w){switch(w.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey).entityId,g.l(w,om(z.S,{mode:"readonly",B1:!0},function(D){var y=Yu(D,K.entityKey,"transfer");D=Yu(D,g.NA(M,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ma.all([y,D])}),2);
case 2:p=w.S;t=g.a(p);B=t.next().value;v=t.next().value;I=B;G=v;if(!I||I.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return w.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.Sq(w,3);I.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.l(w,C4(z.S,I,"transfer"),5);case 5:b=g.B_(I.key).entityId;siZ({videoId:b,MC:I,offlineModeType:(e=G)==null?void 0:e.offlineModeType});g.Eu(w,4);break;case 3:return g.QI(w),w.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return w.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},Uc2=function(z,K,f){f=f===void 0?!1:f;
var M,p,t,B,v,I,G,b,e,w,D,y,R,S,E;return g.n(function(L){switch(L.Y){case 1:return M=g.A(K.actionMetadata,fz8),p=g.B_(K.entityKey).entityId,t=g.NA(p,"downloadStatusEntity"),g.l(L,om(z.S,{mode:"readonly",B1:!0},function(q){var V=Yu(q,t,"downloadStatusEntity");q=Yu(q,g.NA(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ma.all([V,q])}),2);
case 2:return B=L.S,v=g.a(B),I=v.next().value,G=v.next().value,b=I,e=G,w="TRANSFER_STATE_TRANSFER_IN_QUEUE",((D=b)==null?void 0:D.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(w="TRANSFER_STATE_PAUSED_BY_USER"),S={key:K.entityKey,transferState:w,cotn:g.q1(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(y=M)==null?void 0:y.maximumDownloadQuality,preferredAudioTrack:(R=M)==null?void 0:R.preferredAudioTrack,transferRetryCount:0,isRefresh:f,hasLoggedFirstStarted:!1},g.l(L,om(z.S,
{mode:"readwrite",B1:!0},function(q){var V=[];f&&V.push(O6(q,g.NA(p,"offlineVideoStreams")));V.push(Fo(q,S,"transfer"));return g.ma.all(V)}),3);
case 3:if(!f){L.jV(4);break}return g.l(L,FiQ(p),4);case 4:dY7({videoId:p,MC:S,offlineModeType:(E=e)==null?void 0:E.offlineModeType}),g.Rv(L)}})},psZ=function(z,K,f,M){if(!z.action.entityKey)throw Error("entityKey is missing.");
var p=g.B_(z.action.entityKey);p={entityType:p.mO,entityId:p.entityId,offlineOrchestrationActionType:z.action.actionType,orchestrationAction:{orchestrationActionId:z.actionId}};K&&(p.offlineOrchestrationActionResult=K.status,p.isRetryable=f?!1:K.S,K.T&&(p.offlineOrchestrationFailureReason=My_(K.T,p.isRetryable)));var t,B;if((t=z.action.actionMetadata)==null?0:(B=t.offlineLoggingData)==null?0:B.offlineModeType)p.offlineModeType=z.action.actionMetadata.offlineLoggingData.offlineModeType;M&&(p.additionalOrchestrationActions=
M.map(function(v){return{orchestrationActionId:v.actionId}}));
return p},My_=function(z,K){return z!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||K?z==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&K?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":z:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},tyf=function(z,K){var f={offlineOrchestrationContext:psZ(z)};
K=SE9(K,f);uWZ(RE2(),K,z.rootActionId)},By2=function(z,K,f,M){M=M===void 0?[]:M;
K={offlineOrchestrationContext:psZ(z,K,f,M)};K=SE9(3,K);uWZ(RE2(),K,z.rootActionId)},Ny4=function(){this.actions=[]},v4_=function(z,K){K=g.a(K);
for(var f=K.next();!f.done;f=K.next())f=f.value,tyf(f,1),z.actions.push(f);z.actions.sort(z.S)},IzH=function(z,K){if(K)for(var f=0;f<z.actions.length;f++)if(K==="!*$_ALL_ENTITIES_!*$"&&z.actions[f].actionId!==K||K!=="!*$_ALL_ENTITIES_!*$"&&z.actions[f].rootActionId===K&&z.actions[f].actionId!==K)z.actions.splice(f,1),f--},GJ5=function(z,K){z=g.a(z.actions);
for(var f=z.next();!f.done;f=z.next())if(f.value.actionId===K)return!0;return!1},s_=function(z,K,f,M,p){g.J.call(this);
var t=this;this.Y=z;this.nH=K;this.Y1=f;this.G=M;this.SV=p;this.S=new Ny4;this.W=new g.Un;this.T=new g.Kl(function(){t.retry()});
this.D=NaN;this.C=!1;this.dO={e$_:function(){return t.S},
B4:function(){return t.W},
Wme:function(){return t.T},
retry:function(){return t.retry()}};
g.d(this,this.T);this.N=this.Y.observe(this.l_.bind(this))},ws2=function(z,K,f,M,p){var t;
return g.n(function(B){if(B.Y==1)return t=new s_(z,K,f,M,p),g.l(B,blo(t),2);e3Z(t);return B.return(t)})},e3Z=function(z){var K=z.S.actions[0];
return z.J?((K==null?void 0:K.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&z.J[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(z.C=!0),Promise.resolve()):Di_(z)},Di_=function(z){var K,f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E;
return g.n(function(L){switch(L.Y){case 1:if(z.J)throw Error("Already processing an action");if(z.CH())return L.return();K=z.S.actions.shift();gVT(z.Y1,!K);if(K===void 0)return L.return();K.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&K.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&IzH(z.S,K.actionId);f="";K.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&K.rootActionId===K.actionId&&(f=K.actionId);M=[K];z.J=M;if(p=z.nH[K.entityType]){L.jV(2);break}z.J=
void 0;return g.l(L,Di_(z),3);case 3:return L.return();case 2:t=g.a(M);for(B=t.next();!B.done;B=t.next())v=B.value,tyf(v,2);g.Sq(L,4,5);return g.l(L,VPS(p,M.map(function(q){return q.action})),7);
case 7:I=L.S,G=g.a(M),b=G.next();case 8:if(b.done){L.jV(10);break}e=b.value;w=I.get(e.action);return g.l(L,yUH(z,e,w),9);case 9:b=G.next();L.jV(8);break;case 10:IzH(z.S,f);case 5:g.mS(L);z.J=void 0;g.VI(L,6);break;case 4:return D=g.QI(L),Ml("Orchestration error",D),g.Sq(L,12),g.l(L,kJ5(z,M),14);case 14:g.Eu(L,5);break;case 12:y=g.QI(L);Ml("Orchestration retry error",y);R=g.a(M);for(S=R.next();!S.done;S=R.next())E=S.value,E.retryScheduleIndex<3&&v4_(z.S,[E]);L.jV(5);break;case 6:return g.l(L,Di_(z),
0)}})},yUH=function(z,K,f){var M,p,t,B,v,I,G,b,e,w,D,y;
return g.n(function(R){switch(R.Y){case 1:M=K.retryScheduleIndex+2===3;if(f.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){R.jV(2);break}if(f.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){R.jV(0);break}By2(K,f,M);if(f.S&&K.retryScheduleIndex+1<3)return g.l(R,kJ5(z,[K]),0);t=((p=f)==null?0:p.Y)?f.Y:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";B={entityKey:K.action.entityKey,failureReason:t};v=void 0;g.$t(z.SV)?v="mainVideoDownloadStateEntity":g.O$(z.SV)&&(v="musicTrackDownloadMetadataEntity");
if(!v||!f.downloadState){R.jV(7);break}I=g.B_(K.action.entityKey).entityId;return g.l(R,wY(I,v,z.Y,f.downloadState),7);case 7:te(z.G,B);if(f.downloadState==="DOWNLOAD_STATE_FAILED"&&z.SV.B("html5_auto_retry_failed_pde_actions")){R.jV(0);break}Ml("Orchestration result is not retryable, deleting action");return g.l(R,KVQ(z.Y,Rg(K).key),0);case 2:G=void 0;try{G=(b=f.J)==null?void 0:b.map(function(S){return z.createAction(S,K)})}catch(S){return By2(K,f,M),e={entityKey:K.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},te(z.G,e),Ml("Orchestration subactions creation error",S),R.return()}By2(K,f,M,G);if(!G){R.jV(12);break}w=G.map(function(S){return Rg(S)});
D=0;case 13:if(!(D<G.length)||z.C){R.jV(15);break}return g.l(R,om(z.Y,{mode:"readwrite",B1:!0},function(S){var E=[];E.push(xX8(S,w.slice(D,D+10),"offlineOrchestrationActionWrapperEntity"));return g.ma.all(E)}),16);
case 16:D+=10;R.jV(13);break;case 15:if(z.C)return z.C=!1,R.return();case 12:return y=Rg(K),g.l(R,KVQ(z.Y,y.key),17);case 17:tyf(K,4),g.Rv(R)}})},S85=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D;
return g.n(function(y){f=[];M=Infinity;p=4E3;t=g.a(K);for(B=t.next();!B.done;B=t.next())v=B.value,I=Number(v.enqueueTimeSec),G=h3Q(I),b=v.retryScheduleIndex,e=b!=null&&b>0,G>0&&e?(M=Math.min(M,I),p=Math.min(G,p)):f.push(v);isFinite(M)&&(!z.T.isActive()||M<z.D)&&(z.D=M,z.T.start(p));z.W.d$()||(w=f.length,f=f.filter(function(R){var S;R=((S=R.actionProto)==null?void 0:S.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!az8.includes(R)}),D=f.length<w,!z.T.isActive()&&D&&z.T.start(1));
f.length>0&&R3H(z,f);return g.l(y,e3Z(z),0)})},LQf=function(z){var K,f,M,p,t,B,v;
return g.n(function(I){if(I.Y==1)return g.l(I,uiQ(z),2);K=I.S;f=[];M=g.a(K);for(p=M.next();!p.done;p=M.next())t=p.value,B=g.B_(t.key),v=B.entityId,GJ5(z.S,v)||f.push(t);return g.l(I,S85(z,f),0)})},h3Q=function(z){z=z*1E3-Date.now();
return z>4E3?4E3:z},kJ5=function(z,K){var f,M,p;
return g.n(function(t){f=g.a(K);for(M=f.next();!M.done;M=f.next()){p=M.value;var B=void 0,v=void 0,I=((v=p.action)==null?void 0:(B=v.actionMetadata)==null?void 0:B.retryScheduleIntervalsInSeconds)||[1,2,4];B=1;p.retryScheduleIndex<I.length&&(B=I[p.retryScheduleIndex]);p.S=B*1E3+Date.now();p.retryScheduleIndex++}return g.l(t,E4H(z,K),0)})},blo=function(z){var K;
return g.n(function(f){if(f.Y==1)return g.l(f,U6(z.Y,"offlineOrchestrationActionWrapperEntity"),2);K=f.S;return g.l(f,S85(z,K),0)})},R3H=function(z,K){K.length!==0&&K.forEach(function(f){f=ag(f);
f.retryScheduleIndex<3&&v4_(z.S,[f])})},uiQ=function(z,K){var f;
return g.n(function(M){if(M.Y==1)return g.l(M,U6(z.Y,"offlineOrchestrationActionWrapperEntity",K),2);f=M.S;return M.return(f.filter(NS7))})},E4H=function(z,K){if(K.length===0)return Promise.resolve([]);
K=K.map(function(f){return Rg(f)});
return zEH(z.Y,K)},Pxp=function(z){this.Fc=z;
this.S=void 0},Hl8=function(z,K){var f,M,p,t;
return g.n(function(B){f=K.videoId;M=!0;if(K.captionTracks.length)p=su8(K),z.S=new g.LK(z.Fc,K,p);else if(K.C3)t=g.gcW(K),z.S=new g.Pu(z.Fc,K.C3,f,t,K.r_,K.eventId),M=K.r_;else return B.return();return B.return(new Promise(function(v){var I;(I=z.S)==null||I.bT({ij:function(){return g.n(function(G){if(G.Y==1)return g.l(G,z.ij(f,M),2);v();g.Rv(G)})},
jX:function(){}})}))})},QGo=function(z){var K;
return g.n(function(f){if(f.Y==1)return g.l(f,eE5(z),2);K=f.S;return f.return(!!K&&K.length>0)})},Ae=function(z){g.J.call(this);
this.S=z;this.Y=this.S.observe(this.T.bind(this))},q88=function(z,K){var f,M,p,t,B,v,I;
return g.n(function(G){switch(G.Y){case 1:if(K.length===0)return G.return([]);f=K.map(function(b){return g.NA(b,"transfer")});
return g.l(G,U6(z.S,"transfer",f),2);case 2:M=G.S;p=M.filter(NS7).map(function(b){return g.B_(b.key).entityId});
t=K.filter(function(b){return p.indexOf(b)===-1});
if(t.length===0)return G.return([]);B=g.a(t);v=B.next();case 3:if(v.done){G.jV(5);break}I=v.value;return g.l(G,FiQ(I),4);case 4:v=B.next();G.jV(3);break;case 5:return G.return(t)}})},VyS=function(z,K,f,M,p,t){var B,v,I;
return g.n(function(G){B="STREAM_TYPE_UNKNOWN";f.video&&f.audio?(B="STREAM_TYPE_AUDIO_AND_VIDEO",Ml("unexpected stream type")):f.video&&!f.audio?B="STREAM_TYPE_VIDEO":!f.video&&f.audio&&(B="STREAM_TYPE_AUDIO");v=g.NA(K,"offlineVideoStreams");I={numBytesDownloaded:p.toFixed(),numTotalBytes:t.toFixed(),streamType:B,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(M),itag:B==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(f.itag):void 0};return g.l(G,om(z,{mode:"readwrite",B1:!0},
function(b){var e=Yu(b,v,"offlineVideoStreams"),w=Yu(b,g.NA(K,"transfer"),"transfer");return g.ma.all([e,w]).then(function(D){D=g.a(D);var y=D.next().value;D=D.next().value;if(!D)return O6(b,v).then(function(){});
var R=mi4(y);y=lzH(y,M,I,v);var S=Fo(b,y,"offlineVideoStreams");mi4(y)>R&&(D.lastProgressTimeMs=Date.now().toString());R=[S];D.offlineVideoStreams||(D.offlineVideoStreams=[]);D.offlineVideoStreams.indexOf(v)===-1&&(D.offlineVideoStreams.push(v),R.push(Fo(b,D,"transfer")));return g.ma.all(R)})}),0)})},n41=function(z,K){var f,M,p,t,B;
return g.n(function(v){if(v.Y==1)return f=g.NA(K,"offlineVideoStreams"),g.l(v,TY(z,f,"offlineVideoStreams"),2);M=v.S;if(!M||!M.streamsProgress)return v.return();p=g.a(M.streamsProgress);for(t=p.next();!t.done;t=p.next())B=t.value,B.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",B.numTotalBytes!==B.numBytesDownloaded&&(B.numBytesDownloaded=B.numTotalBytes);return g.l(v,C4(z,M,"offlineVideoStreams"),0)})},lzH=function(z,K,f,M){if(z&&z.streamsProgress){M=z;
a:{K=K.itag+";"+K.xtags;for(var p=z.streamsProgress,t=0;t<p.length;t++){var B=JSON.parse(p[t].formatStreamBytes);if(B.itag+";"+B.xtags===K){p[t]=f;f=p;break a}}p.push(f);f=p}M.streamsProgress=f}else z={key:M,streamsProgress:[f]};return z},mi4=function(z){if(z==null?0:z.streamsProgress){var K=0;
z=z.streamsProgress;for(var f=0;f<z.length;f++){var M=z[f];isNaN(Number(M.numBytesDownloaded))?Ml("stream progress bytes number invalid"):K+=Number(M.numBytesDownloaded)}return K}return 0},WQ4=function(z,K,f,M){g.J.call(this);
var p=this;this.Y=z;this.api=K;this.Xc=f;this.l_=M;this.W=new g.Un;this.J=new g.Kl(function(){p.S&&p.S.transferState==="TRANSFER_STATE_TRANSFERRING"&&p.W.d$()&&((p.S.transferRetryCount||0)<3?cV(p.G,p.C,!1,!1):dY(p.G,p.C.videoDetails.videoId),p.Ig("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Y1=this.eV=0;this.N=this.D=!1;this.QE=g.uY(this.api.Z().experiments,"html5_transfer_processing_logs_interval");this.Px=new g.xI(this);this.dO={iDe:function(){return p.J},
q_1:function(){return p.l_},
B4:function(){return p.W}};
this.nH=this.Y.observe(this.uf.bind(this));this.G=new xcH(K,this);this.b_=new Pxp(K);this.Hx=new Ae(this.Y);this.vx=this.W.listen("publicytnetworkstatus-online",this.sy.bind(this));this.Bx=this.W.listen("publicytnetworkstatus-offline",this.Qch.bind(this));this.N=this.api.Z().B("html5_less_transfer_processing_logs");g.d(this,this.Px);this.Px.X(K,"offlinetransferpause",this.VUe);g.$t(this.api.Z())?this.T="mainVideoDownloadStateEntity":g.O$(this.api.Z())&&(this.T="musicTrackDownloadMetadataEntity")},
JU7=function(z){return g.n(function(K){if(K.Y==1)K=g.l(K,Gh5(),2);
else{var f=z.Hx;var M=g.JX();M=Object.keys(M);f=q88(f,M);K=g.l(K,f,0)}return K})},Y_=function(z,K){K=K===void 0?!1:K;
var f;return g.n(function(M){if(M.Y==1){if(z.S)throw Error("Already downloading a video");z.Y1=0;z.D=!1;return g.l(M,g4Q(z),2)}return M.Y!=4?(f=M.S,iVf(z.Xc,!f),f&&z.W.d$()?K?g.l(M,new Promise(function(p){g.Sg(p,1E3)}),4):M.jV(4):(!f&&z.S&&jM(z),M.jV(0))):g.l(M,il2(z,f),0)})},diS=function(z){return g.n(function(K){if(K.Y==1)return z.C?g.l(K,dY(z.G,z.C.videoDetails.videoId),3):K.jV(0);
jM(z);g.Rv(K)})},cUH=function(z,K){var f,M,p;
return g.n(function(t){switch(t.Y){case 1:return g.Sq(t,2),(f=!!K.captionTracks.length||!!K.C3)?g.l(t,QGo(K.videoId),4):t.return();case 4:return(M=t.S)?t.return():g.l(t,Hl8(z.b_,K),5);case 5:g.Eu(t,0);break;case 2:p=g.QI(t),Ml("Caption downloading error",p,K.cotn),g.Rv(t)}})},il2=function(z,K){var f,M,p,t,B,v;
return g.n(function(I){switch(I.Y){case 1:if(z.D)return I.return();z.D=!0;z.S=K;f=g.B_(z.S.key);M=f.entityId;p=void 0;if(z.S.transferState==="TRANSFER_STATE_TRANSFERRING")return g.l(I,x_(z,M),7);if(z.S.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||z.S.transferRetryCount||z.S.hasLoggedFirstStarted){I.jV(3);break}return g.l(I,x_(z,M),5);case 5:return p=I.S,z.S.hasLoggedFirstStarted=!0,g.l(I,sG2(z),6);case 6:cmH({videoId:M,MC:z.S,offlineModeType:p},void 0,void 0,!0);I.jV(3);break;case 7:p=I.S,
vV({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:M,MC:z.S,offlineModeType:p});case 3:return g.l(I,AUf(z),8);case 8:return t=null,g.Sq(I,9),g.l(I,jGo(z,K),11);case 11:t=I.S;z.C=t;g.Eu(I,10);break;case 9:return B=g.QI(I),Ml("error getting player response",B,K.cotn),g.l(I,z.Ig("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return I.return();case 10:return v=FVS(z.api.Z(),K.cotn,t),g.l(I,cUH(z,v),13);case 13:return g.l(I,OG_(v.videoId),
14);case 14:v.fE=I.S,C24(z.G,v,K.maximumDownloadQuality),z.J.start(108E5),g.Rv(I)}})},g4Q=function(z){var K,f;
return g.n(function(M){if(M.Y==1)return g.l(M,U6(z.Y,"transfer"),2);K=M.S;f=K.filter(Y8f).sort(Xs5);return f.length===0?M.return():M.return(f[0])})},AUf=function(z){var K,f,M;
return g.n(function(p){if(p.Y==1){if(!z.S)return FR(z,"onTransferStart"),p.return();z.J.start(108E5);return g.l(p,O_(z,"TRANSFER_STATE_TRANSFERRING"),2)}K=z.S;return(M=((f=K)==null?0:f.key)?g.B_(K.key).entityId:"")&&z.T?g.l(p,wY(M,z.T,z.Y,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):p.jV(0)})},ZGo=function(z){var K,f,M,p;
g.n(function(t){switch(t.Y){case 1:if(!z.S){FR(z,"onTransferPausedByUser");t.jV(2);break}K=z.S;z.J.stop();return g.l(t,O_(z,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:M=((f=K)==null?0:f.key)?g.B_(K.key).entityId:"";if(!M||!z.T){t.jV(4);break}return g.l(t,wY(M,z.T,z.Y,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.l(t,x_(z,M),6);case 6:p=t.S,Am1({videoId:M,MC:K,offlineModeType:p});case 2:jM(z),Y_(z),g.Rv(t)}})},onZ=function(z){var K,f,M;
g.n(function(p){if(p.Y==1){if(!z.S)return FR(z,"onTransferPausedByNetwork"),p.return();z.J.stop();return g.l(p,O_(z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(p.Y!=3)return K=z.S,(M=((f=K)==null?0:f.key)?g.B_(K.key).entityId:"")&&z.T?g.l(p,wY(M,z.T,z.Y,"DOWNLOAD_STATE_PAUSED"),3):p.jV(3);jM(z);g.Rv(p)})},xi7=function(z){var K,f,M,p,t;
g.n(function(B){switch(B.Y){case 1:if(!z.S)return FR(z,"onTransferComplete"),B.return();K=z.S;z.J.stop();if(!K||!z.C){B.jV(2);break}f=FVS(z.api.Z(),K.cotn,z.C);return g.l(B,cUH(z,f),2);case 2:return g.l(B,O_(z,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:p=((M=K)==null?0:M.key)?g.B_(K.key).entityId:"";if(!p||!z.T){B.jV(5);break}return g.l(B,wY(p,z.T,z.Y,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.l(B,n41(z.Y,p),7);case 7:return g.l(B,x_(z,p),8);case 8:t=B.S,vV({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:p,MC:K,offlineModeType:t}),jM(z),Y_(z),g.Rv(B)}})},FQH=function(z,K,f){var M,p;
g.n(function(t){switch(t.Y){case 1:if(!z.S)return FR(z,"onTransferProgress: "+K),t.return();if(z.S.transferState==="TRANSFER_STATE_TRANSFERRING"){t.jV(2);break}return g.l(t,AUf(z),2);case 2:M=Date.now();if(!(M-z.eV>1E3)){t.jV(4);break}z.eV=M;return g.l(t,VyS(z.Y,f.videoId,f.Y,f.iK,f.bytesDownloaded,f.S),5);case 5:if(z.N&&!(z.N&&M-z.Y1>z.QE)){t.jV(4);break}z.Y1=M;return g.l(t,x_(z,K),7);case 7:p=t.S,cmH({videoId:K,MC:z.S,offlineModeType:p},f.bytesDownloaded,f.S);case 4:z.J.start(108E5),g.Rv(t)}})},
Ol7=function(z){var K=(z.S.transferRetryCount||0)<3;
K&&(z=z.S,z.transferRetryCount=(z.transferRetryCount||0)+1);return K},rU_=function(z,K){K=K===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":K;
var f,M,p,t;return g.n(function(B){if(B.Y==1)return z.S||FR(z,"setTransferToFailed: "+K),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K==="TRANSFER_FAILURE_REASON_NETWORK"?f="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":K==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.l(B,O_(z,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",K),2);if(B.Y!=3)return te(z.l_,{entityKey:(M=z.S)==null?void 0:M.key,failureReason:f}),
p=z.S?g.B_(z.S.key).entityId:"",g.l(B,x_(z,p),3);t=B.S;var v={videoId:p,MC:z.S,offlineModeType:t},I=K,G={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};I&&(G.transferFailureReason=I,G.failureReason=jiS(I));vV(G,v);g.Rv(B)})},O_=function(z,K,f,M){var p;
return g.n(function(t){if(t.Y==1){if(!z.S)return FR(z,"saveTransferState: "+K),t.return();z.S.transferState=K;z.S.failureReason=M;g.Sq(t,2);return g.l(t,sG2(z,function(B){return f?Xo(B,"offlineVideoStreams",z.S.offlineVideoStreams).then(function(v){for(var I=g.a(v),G=I.next();!G.done;G=I.next())if((G=G.value)&&G.streamsProgress){G=g.a(G.streamsProgress);for(var b=G.next();!b.done;b=G.next())b.value.streamState=f}return xX8(B,v.filter(function(e){return!!e}),"offlineVideoStreams")}):g.ma.resolve(void 0)}),
4)}if(t.Y!=2)return g.Eu(t,0);
p=g.QI(t);return p instanceof g.uN&&p.type==="QUOTA_EXCEEDED"?g.l(t,z.Ig("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):t.jV(0)})},sG2=function(z,K){var f;
return g.n(function(M){if(!z.S)return M.return();f=z.S;return g.l(M,om(z.Y,{mode:"readwrite",B1:!0},function(p){var t=[Fo(p,f,"transfer")];K&&t.push(K(p));return g.ma.all(t)}),0)})},jM=function(z){z.S=void 0;
z.C=void 0;z.J.stop()},jGo=function(z,K){var f,M,p,t,B;
return g.n(function(v){if(v.Y==1)return f=g.B_(K.key),M=f.entityId,p=g.NA(M,"playbackData"),g.l(v,TY(z.Y,p,"playbackData"),2);t=v.S;if((B=t)==null?0:B.playerResponseJson)return v.return(JSON.parse(t.playerResponseJson));throw Error("No PlayerResponse found");})},FR=function(z,K){z.api.Th("woffle",{mcte:K});
Ml("missing current transfer entity.")},x_=function(z,K){var f,M,p;
return g.n(function(t){if(t.Y==1)return g.l(t,TY(z.Y,g.NA(K,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);f=t.S;return t.return((p=(M=f)==null?void 0:M.offlineModeType)!=null?p:void 0)})},Y8f=function(z){return Zl2[z.transferState]!==void 0},Xs5=function(z,K){var f=Zl2[z.transferState],M=Zl2[K.transferState];
return f!==M?f-M:Number(z.enqueuedTimestampMs)-Number(K.enqueuedTimestampMs)},rY=function(z,K){var f=this;
this.SV=z;this.api=K;this.W=new g.Un;this.C=new g.ai;this.dO={v4:function(){return f.T.dO.v4()},
B4:function(){return f.W},
Jne:function(){return f.T},
yZ:function(){return f.yZ()},
HN:function(){return f.HN()},
hs:function(){return f.hs()},
PQ:function(){return f.PQ()},
Id:function(){return f.Id()},
Xz:function(M){return f.Xz(M)}};
this.T=new nVZ(function(){return o4p(f)},function(){f.hs()},this.api.cC(),this.api.B.bind(this.api));
this.S=new pA(this.api);WVZ(this.T)},o4p=function(z){return g.n(function(K){z.api.LH("onOrchestrationBecameLeader");
return g.l(K,z.HN(),0)})},Ty9=function(z){var K,f;
return g.n(function(M){if(M.Y==1)return g.l(M,za(),2);if(M.Y!=3){K=M.S;if(!K)return Ml("PES is undefined"),M.return();z.Y=new WQ4(K,z.api,z.T,z.S);f=z.Kr(K);return g.l(M,ws2(K,f,z.T,z.S,z.SV),3)}z.G=M.S;return g.l(M,Cx7(z),0)})},Cx7=function(z){var K;
return g.n(function(f){switch(f.Y){case 1:if(!z.Y)return Ml("transferManager is undefined"),f.return();if(z.Y.S){f.jV(2);break}return g.l(f,Y_(z.Y),2);case 2:if(!z.SV.B("woffle_enable_main_downloads_library")){f.jV(4);break}return g.l(f,z.Fe(),4);case 4:if(!z.SV.B("html5_offline_playback_position_sync")){f.jV(6);break}return g.l(f,z.Ly(),7);case 7:return g.l(f,z.Xz(864E5),6);case 6:return g.l(f,z.refreshAllStaleEntities(43200,!0),9);case 9:return g.l(f,z.uQ(),10);case 10:if(!z.SV.B("html5_retry_downloads_for_expiration")){f.jV(11);
break}return g.l(f,z.Id(),11);case 11:return z.D=g.um(function(){z.refreshAllStaleEntities(43200,!0);z.uQ()},9E5),g.Mg(g.tO(),function(){return z.PQ()}),g.l(f,za(),13);
case 13:return K=f.S,g.l(f,VIQ(K),14);case 14:Jm_(z.T),g.Rv(f)}})},Ui9=function(){var z,K,f,M,p,t;
return g.n(function(B){switch(B.Y){case 1:return g.l(B,za(),2);case 2:z=B.S;if(!z)return B.return([]);K=Date.now()/1E3;return g.l(B,U6(z,"offlineVideoPolicy"),3);case 3:f=B.S,M=g.a(f),p=M.next();case 4:if(p.done){B.jV(6);break}t=p.value;if(!(t.expirationTimestamp&&Number(t.expirationTimestamp)<K)){B.jV(5);break}t.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";t.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.l(B,C4(z,t,"offlineVideoPolicy"),5);
case 5:p=M.next();B.jV(4);break;case 6:return B.return(f.map(function(v){return v.key}))}})},Z_=function(z,K,f,M,p){var t,B,v;
return g.n(function(I){if(I.Y==1)return g.l(I,za(),2);t=I.S;if(!t)return I.return([]);B=K.map(function(G){var b=g.NA(G,f);b={actionType:M,entityKey:b,actionMetadata:Object.assign({},OV_(),p)};M!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(b.actionMetadata.priority=0);G=new he(f,G,b);return Rg(G)});
v=zEH(t,B);WVZ(z.T);return I.return(v)})},zn1=function(z,K,f,M){var p,t,B,v,I,G,b,e;
return g.n(function(w){switch(w.Y){case 1:p=[],t=g.a(K),B=t.next();case 2:if(B.done){w.jV(4);break}v=B.value;if(v.upToDate||f&&!v.shouldAutoSyncMetadata||!v.playlistId){w.jV(3);break}I={};switch(M){case "mainPlaylistEntity":G={nextAutoRefreshIntervalSeconds:v.checkInSeconds,autoSync:f};I={mainPlaylistEntityActionMetadata:G};break;case "musicPlaylist":b={autoSync:f},I={musicPlaylistEntityActionMetadata:b}}return g.l(w,Z_(z,[v.playlistId],M,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I),6);case 6:(e=
w.S)&&p.push.apply(p,g.P(e));case 3:B=t.next();w.jV(2);break;case 4:return w.return(p)}})},K9Z=function(z,K){var f;
return g.n(function(M){return K.length?(f=OV_(),g.Om(f,gY,{isEnqueuedForExpiredStreamUrlRefetch:!0}),z.api.Th("qrd",{v:K.length}),M.return(Z_(z,K,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",f))):M.return([])})},$zf=function(z,K,f){this.S=z;
this.SV=K;this.T=f},pmT=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L;
return g.n(function(q){switch(q.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,t=[],g.Sq(q,2),g.l(q,fBS(z,p),4);case 4:t=q.S;if(!(z.SV.B("woffle_enable_main_downloads_library")&&((B=t)==null?0:B.length))){q.jV(5);break}return g.l(q,tPS(z.S,[K.entityKey]),5);case 5:g.Eu(q,3);break;case 2:return v=g.QI(q),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.uN&&v.type==="QUOTA_EXCEEDED"?(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Ml("Playlist add error"),q.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,I,G));case 3:b=[];if(!z.SV.B("html5_offline_prevent_redownload_downloaded_video")){q.jV(7);break}return g.l(q,xYH(z.S,"mainVideoEntity",t),8);case 8:t=q.S;case 7:if((e=t)==null?0:e.length)for(w=g.a(t),D=w.next();!D.done;D=w.next())if(y=D.value,R=y.offlineVideoData,S=void 0,(S=R)==null?0:S.videoId)E=void 0,L=Number(((E=K.actionMetadata)==null?void 0:E.priority)||
0)+1,b.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"mainVideoEntity",L,og,M4p(K,R,p)));return q.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,b))}})},Bep=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u,N8,rZ,LL,VQ,wZ,jq,i_,n1,H,Q,m,W,Y,LW,KW,hd,fW,l8,To,E9,EP,gr,zz,ZK,Ke,EU,yV,i6,Rz,d4,Z9,ou,ld,B9,$p,Nn,gh,TE;
return g.n(function(ko){switch(ko.Y){case 1:return f=Ig(K),M=K.entityKey,p=g.B_(M).entityId,t=[],B=!1,p==="!*$_ALL_ENTITIES_!*$"?(B=!0,g.l(ko,U6(z.S,"mainPlaylistEntity"),5)):g.l(ko,TY(z.S,M,"mainPlaylistEntity"),4);case 4:(v=ko.S)&&t.push(v);ko.jV(3);break;case 5:t=ko.S;case 3:if((I=t)==null||!I.length)return ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));G=g.A(K.actionMetadata,t47);e=(b=G)==null?void 0:b.nextAutoRefreshIntervalSeconds;D=(w=G)==null?void 0:w.autoSync;y=[];S=R=
!0;E=!1;if(!B&&D===!1){ko.jV(6);break}g.Sq(ko,7);return g.l(ko,Rb_(0,!!D,!0,t),9);case 9:y=ko.S;g.Eu(ko,8);break;case 7:L=g.QI(ko);if(!(L instanceof Error&&L.message==="No data")){L instanceof Error&&L.message==="Empty response body"&&Ml(L.message);ko.jV(8);break}return p==="!*$_ALL_ENTITIES_!*$"?g.l(ko,zbZ(z.S,K,z.T,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.l(ko,TS9(p,z.S,K,z.T),8);case 8:if(!y.length||!B&&y[0].playlistId!==p)return ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f));case 6:if(B){q=[];V=g.a(y);for(c=V.next();!c.done;c=V.next())O=c.value,O.upToDate||D&&!O.shouldAutoSyncMetadata||!O.playlistId||(x={nextAutoRefreshIntervalSeconds:O.checkInSeconds,autoSync:D},q.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O.playlistId,"mainPlaylistEntity",0,og,{mainPlaylistEntityActionMetadata:x})));return ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,q))}y.length&&(T=y[0],E=!!T.upToDate,D&&(R=(M8=T.shouldAutoSyncMetadata)!=null?M8:!0,S=($S=T.shouldAutoSyncVideos)!=
null?$S:!0,T.checkInSeconds&&(e=T.checkInSeconds)));if(E||!R)return ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));td=[];r=t[0];if(!r.downloadState){yI=void 0;ko.jV(15);break}return g.l(ko,TY(z.S,r.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:yI=ko.S;case 15:return H5=yI,Ho=((ra=H5)==null?0:ra.addedTimestampMillis)?String(H5.addedTimestampMillis):void 0,g.Sq(ko,17),g.l(ko,fBS(z,p,Ho,e),19);case 19:td=ko.S;g.Eu(ko,18);break;case 17:I8=g.QI(ko);if(!(I8 instanceof
Error&&I8.message==="No data for playlist")){if(I8 instanceof Error&&I8.message==="Empty response body for playlist")Ml(I8.message);else return q8="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I8 instanceof g.uN&&I8.type==="QUOTA_EXCEEDED"&&(q8="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,q8,P5));
ko.jV(18);break}return g.l(ko,TS9(p,z.S,K,z.T),18);case 18:if(!S)return ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));t2=[];u=new Map;if((N8=td)==null?0:N8.length)for(rZ=g.a(td),LL=rZ.next();!LL.done;LL=rZ.next())VQ=LL.value,wZ=VQ.offlineVideoData,jq=void 0,((jq=wZ)==null?0:jq.videoId)&&u.set(wZ.videoId,wZ);i_=new Map;n1=[];if((H=r)==null?0:(Q=H.videos)==null?0:Q.length)for(m=g.a(r.videos),W=m.next();!W.done;W=m.next())if(Y=W.value,LW=JSON.parse(g.B_(Y).entityId),KW=LW.videoId)u.has(KW)?
(i_.set(KW,u.get(KW)),u.delete(KW)):n1.push(KW);fW=Number(((hd=K.actionMetadata)==null?void 0:hd.priority)||0)+1;l8=g.a(u.entries());for(To=l8.next();!To.done;To=l8.next())E9=To.value,EP=g.a(E9),gr=EP.next().value,zz=EP.next().value,ZK=gr,Ke=zz,t2.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ZK,"mainVideoEntity",fW,og,M4p(K,Ke,p)));EU=g.a(i_.entries());for(yV=EU.next();!yV.done;yV=EU.next())i6=yV.value,Rz=g.a(i6),d4=Rz.next().value,Z9=Rz.next().value,ou=d4,ld=Z9,t2.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
ou,"mainVideoEntity",fW,og,M4p(K,ld,p)));B9=g.a(n1);for($p=B9.next();!$p.done;$p=B9.next())Nn=$p.value,gh={playlistId:p},TE={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:gh},t2.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Nn,"mainVideoEntity",0,og,TE));return ko.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,t2))}})},Nef=function(z,K){var f,M,p,t;
return g.n(function(B){switch(B.Y){case 1:return f=Ig(K),g.Sq(B,2),M=g.B_(K.entityKey).entityId,M==="!*$_ALL_ENTITIES_!*$"?g.l(B,zbZ(z.S,K,z.T,(p=K.actionMetadata)==null?void 0:(t=p.offlineLoggingData)==null?void 0:t.offlineDeleteReason),5):g.l(B,TS9(M,z.S,K,z.T),6);case 6:if(!z.SV.B("woffle_enable_main_downloads_library")){B.jV(5);break}return g.l(B,BhT(z.S,K.entityKey),5);case 5:g.Eu(B,3);break;case 2:return g.QI(B),B.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},fBS=function(z,K,f,M){var p,t,B,v,I,G,b;
return g.n(function(e){switch(e.Y){case 1:return g.l(e,hbQ([K]),2);case 2:return p=e.S,g.l(e,vLp(z,p[0],f,M),3);case 3:return t=e.S,B=t.mainPlaylistEntity,v=t.whV,G=oVf(B,(I=v)==null?void 0:I.avatar),g.Sq(e,4),g.l(e,u7(G),6);case 6:g.Eu(e,5);break;case 4:b=g.QI(e),b instanceof Error&&b.message==="Failed to fetch"&&Ml(b.message);case 5:return e.return(p[0].videos)}})},vLp=function(z,K,f,M){var p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V;
return g.n(function(c){switch(c.Y){case 1:p=Date.now().toString();f||(f=p);t=K.videos;B=K.playlistId;v=[];I=[];if(t)for(G=g.a(t),b=G.next();!b.done;b=G.next()){e=b.value;w=e.offlineVideoData;if(!w||!w.videoId)throw Ml("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");D=w.videoId;y={videoId:D,playlistId:B};R={id:g.NA(JSON.stringify(y),"mainPlaylistVideoEntity"),video:g.NA(D,"mainVideoEntity")};v.push(R);I.push(R.id)}E={key:g.NA(B,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:f,lastSyncedTimestampMillis:p};L={key:g.NA(B,"mainPlaylistEntity"),playlistId:B,videos:I,title:K.title,thumbnailStyleData:IB5(K),visibility:GEf(K),downloadState:E.key};K.channel&&(q=K.channel.offlineChannelData,S=btp(g.NA(B,"ytMainChannelEntity"),q),L.channelOwner=S.id);((V=L)==null?0:V.entityMetadata)?(L.entityMetadata.offlineLastModifiedTimestampSeconds=K.lastModifiedTimestamp,M&&(L.entityMetadata.nextAutoRefreshIntervalSeconds=String(M))):L&&(L.entityMetadata={nextAutoRefreshIntervalSeconds:M?
String(M):void 0,offlineLastModifiedTimestampSeconds:K.lastModifiedTimestamp});g.Sq(c,2);return g.l(c,om(z.S,{mode:"readwrite",B1:!0},function(O){var x=Fo(O,L,"mainPlaylistEntity"),T=Fo(O,E,"mainPlaylistDownloadStateEntity");x=[x,T];T=g.a(v);for(var M8=T.next();!M8.done;M8=T.next())x.push(Fo(O,M8.value,"mainPlaylistVideoEntity"));S&&x.push(Fo(O,S,"ytMainChannelEntity"));return g.ma.all(x)}),4);
case 4:g.Eu(c,3);break;case 2:throw g.QI(c),Ml("PES failure for playlist"),Error("PES failure for playlist");case 3:return c.return({mainPlaylistEntity:L,whV:S,Xna:v})}})},btp=function(z,K){return{id:z,
channelId:K.channelId,title:K.title,avatar:K.thumbnail}},IB5=function(z){var K=[],f=z.videos;
f&&f.length>0&&K.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:f[0].offlineVideoData.thumbnail}}});if((z=z.additionalMetadadatas)&&z.length>0)for(z=g.a(z),f=z.next();!f.done;f=z.next()){var M=f.value.offlineBundleItemPlaylistData,p=void 0;f=(p=M)==null?void 0:p.style;p=void 0;M={collageThumbnail:{coverThumbnail:(p=M)==null?void 0:p.coverThumbnail}};switch(f){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":K.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:M});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":K.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:M});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":K.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:M});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":K.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:M})}}return K},GEf=function(z){switch(z.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},M4p=function(z,K,f){K={offlineVideoData:K,
playlistId:f};if(z=g.A(z.actionMetadata,t47))K.maximumDownloadQuality=z.maximumDownloadQuality;return{mainVideoEntityActionMetadata:K}},en2=function(z,K,f){this.S=z;
this.SV=K;this.T=f},yST=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y;
return g.n(function(R){switch(R.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,t=g.A(K.actionMetadata,CA),v=!((B=t)==null?0:B.playlistId),g.Sq(R,2),g.l(R,wmZ(z,p,void 0,(I=t)==null?void 0:I.offlineVideoData,v),4);case 4:g.Eu(R,3);break;case 2:return G=g.QI(R),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.uN&&G.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,b,e));case 3:w=1;w=Number(((D=K.actionMetadata)==null?void 0:D.priority)||0)+1;var S=(S=g.A(K.actionMetadata,CA))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;y=WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"playbackData",w,Dz4,S);return R.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,[y]))}})},kE2=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L;
return g.n(function(q){switch(q.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,g.l(q,TY(z.S,K.entityKey,"mainVideoEntity"),2);case 2:t=q.S;if(!t){B=void 0;q.jV(3);break}return g.l(q,TY(z.S,t.downloadState,"mainVideoDownloadStateEntity"),4);case 4:B=q.S;case 3:v=B;if(!t||!v)return q.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.Sq(q,5);return g.l(q,wmZ(z,p,v.addedTimestampMillis,(G=g.A(K.actionMetadata,CA))==null?void 0:G.offlineVideoData),7);case 7:b=1;b=Number(((e=
K.actionMetadata)==null?void 0:e.priority)||0)+1;I=WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"playbackData",b,Dz4);g.Eu(q,6);break;case 5:w=g.QI(q);if(!(w instanceof Error&&w.message==="No data")){if(w instanceof Error&&w.message==="Empty response body")Ml(w.message);else return D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.uN&&w.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,D,y));q.jV(6);break}return g.l(q,PV(z.S,p),9);case 9:R=q.S;S=g.A(K.actionMetadata,CA);if(L=(E=S)==null?void 0:E.playlistId)R.playlistId=L;R.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.l(q,LA(p,z.S,K,z.T,R),6);case 6:return q.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,I?[I]:void 0))}})},hnS=function(z,K){var f,M,p,t,B,v,I,G,b,e;
return g.n(function(w){switch(w.Y){case 1:return f=Ig(K),g.Sq(w,2),M=g.B_(K.entityKey).entityId,M==="!*$_ALL_ENTITIES_!*$"?g.l(w,zbZ(z.S,K,z.T,(b=K.actionMetadata)==null?void 0:(e=b.offlineLoggingData)==null?void 0:e.offlineDeleteReason),5):g.l(w,PV(z.S,M),6);case 6:p=w.S;t=g.A(K.actionMetadata,CA);if(v=(B=t)==null?void 0:B.playlistId)p.playlistId=v;p.offlineDeleteReason=(I=K.actionMetadata)==null?void 0:(G=I.offlineLoggingData)==null?void 0:G.offlineDeleteReason;return g.l(w,LA(M,z.S,K,z.T,p),7);
case 7:if(!z.SV.B("woffle_enable_main_downloads_library")){w.jV(5);break}return g.l(w,BhT(z.S,K.entityKey),5);case 5:g.Eu(w,3);break;case 2:return g.QI(w),w.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return w.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},wmZ=function(z,K,f,M,p){var t,B,v,I,G,b;
return g.n(function(e){switch(e.Y){case 1:if(t=M){e.jV(2);break}return g.l(e,k$H([K]),3);case 3:B=e.S,t=B[0];case 2:return g.l(e,aBp(z,t,f,p),4);case 4:v=e.S;I=v.mainVideoEntity;G=v.channelEntity;g.Sq(e,5);var w=k_(I.thumbnail),D=k_(G.avatar);return g.l(e,u7(w.concat(D)),7);case 7:g.Eu(e,0);break;case 5:b=g.QI(e),b instanceof Error&&b.message==="Failed to fetch"&&Ml(b.message),g.Rv(e)}})},aBp=function(z,K,f,M){var p,t,B,v,I,G,b,e,w,D,y,R,S;
return g.n(function(E){switch(E.Y){case 1:f||(f=Date.now().toString());t=(p=K.channel)==null?void 0:p.offlineChannelData;B={id:g.NA(K.videoId,"ytMainChannelEntity"),channelId:t.channelId,title:t.title,avatar:t.thumbnail};v={key:g.NA(K.videoId,"mainVideoDownloadStateEntity"),playbackData:g.NA(K.videoId,"playbackData"),addedTimestampMillis:f,videoDownloadContextEntity:g.NA(K.videoId,"videoDownloadContextEntity")};I={key:g.NA(K.videoId,"videoPlaybackPositionEntity"),videoId:K.videoId,lastPlaybackPositionSeconds:"0"};
z.SV.B("html5_offline_playback_position_sync")&&(G={playbackPosition:I.key});b=g.NA(K.videoId,"mainVideoEntity");e={key:b,videoId:K.videoId,title:K.title,thumbnail:K.thumbnail,localizedStrings:{viewCount:K.shortViewCountText},userState:G,lengthSeconds:K.lengthSeconds?Number(K.lengthSeconds):void 0,publishedTimestampMillis:K.publishedTimestamp?(Number(K.publishedTimestamp)*1E3).toString():void 0,formattedDescription:K.description,owner:B.id,downloadState:v.key};if(!z.SV.B("woffle_enable_main_downloads_library")||
!M){E.jV(2);break}return g.l(E,px5(z.S,[b]),3);case 3:if(y=E.S)w=y.mainDownloadsLibraryEntity,D=y.mainDownloadsListEntity;case 2:return S=Xc7,R={key:g.NA(K.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Om(v,S,R),g.l(E,om(z.S,{mode:"readwrite",B1:!0},function(L){var q=Fo(L,B,"ytMainChannelEntity"),V=Fo(L,v,"mainVideoDownloadStateEntity"),c=Fo(L,e,"mainVideoEntity");q=[q,V,c];z.SV.B("html5_offline_playback_position_sync")&&(V=Fo(L,I,"videoPlaybackPositionEntity"),
q.push(V));w&&(V=Fo(L,w,"mainDownloadsLibraryEntity"),q.push(V));D&&(V=Fo(L,D,"mainDownloadsListEntity"),q.push(V));R&&(L=Fo(L,R,"downloadStatusEntity"),q.push(L));return g.ma.all(q)}),4);
case 4:return E.return({mainVideoEntity:e,channelEntity:B})}})},Rn2=function(z,K,f){this.S=z;
this.SV=K;this.T=f},uPZ=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r;
return g.n(function(yI){switch(yI.Y){case 1:return f=Ig(K),M=[],g.l(yI,s6.getInstance(),2);case 2:p=yI.S;if(!p){yI.jV(3);break}return g.l(yI,p.get("sdois"),4);case 4:return t=yI.S,g.l(yI,(v=p)==null?void 0:v.get("lmqf"),5);case 5:B=yI.S;case 3:g.Sq(yI,6);if(t===void 0)throw Error("prefStorage or opt-in state is undefined");I=[];if(t){yI.jV(8);break}return g.l(yI,MP9(z.S),9);case 9:I=yI.S,I.reverse();case 8:if(!I.length){yI.jV(10);break}G=g.a(I);b=G.next();case 11:if(b.done){yI.jV(10);break}e=b.value;
if(!e){yI.jV(12);break}w=g.B_(e).entityId;return g.l(yI,PV(z.S,w),14);case 14:return D=yI.S,D.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.l(yI,LA(w,z.S,{entityKey:e,actionType:K.actionType},z.T,D),12);case 12:b=G.next();yI.jV(11);break;case 10:return g.l(yI,u8H(t,(y=B)!=null?y:"SD"),16);case 16:return R=yI.S,g.l(yI,KiQ(R),17);case 17:S=fV7(R);if(!z.SV.B("woffle_enable_main_downloads_library")){yI.jV(18);break}if(t){yI.jV(19);break}return g.l(yI,BhT(z.S,g.i9),19);case 19:return g.l(yI,
tPS(z.S,[g.i9]),18);case 18:if((E=S)==null?0:E.length)for(L=g.a(S),q=L.next();!q.done;q=L.next())if(c=V=q.value,O=c.actionType,x=c.entityKey,T=c.actionMetadata,O&&x&&T&&!g.A(T,SpQ)){O==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(T.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(M8=g.A(V.actionMetadata,CA))M8.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",V.actionMetadata=Object.assign({},V.actionMetadata,{mainVideoEntityActionMetadata:M8});M.push(V)}g.Eu(yI,
7);break;case 6:return $S=g.QI(yI),td="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",$S instanceof g.uN&&$S.type==="QUOTA_EXCEEDED"&&(td="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),yI.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,td,r));case 7:return yI.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,M))}})},L9_=function(){rY.apply(this,
arguments);
this.N="mainVideoEntity"},ELT=function(z,K,f){K=K===void 0?43200:K;
f=f===void 0?!0:f;var M=M===void 0?!1:M;var p,t,B;return g.n(function(v){switch(v.Y){case 1:if(!z.W.d$())return v.return([]);p=[];g.Sq(v,2);return g.l(v,Rb_(K,f,M),4);case 4:p=v.S;g.Eu(v,3);break;case 2:t=g.QI(v),t instanceof Error&&t.message==="No data"||t instanceof Error&&t.message==="Empty response body"&&Ml(t.message);case 3:return B=zn1(z,p,f,"mainPlaylistEntity"),v.return(B)}})},PlH=function(z,K,f,M){M=M===void 0?!1:M;
var p,t,B,v,I,G,b,e,w,D,y,R,S,E,L;return g.n(function(q){switch(q.Y){case 1:return p=[],g.l(q,SDp(),2);case 2:return(t=q.S)||M?g.l(q,LiS(K,f),3):q.return([]);case 3:B=q.S;if((v=B)==null||!v.length)return q.return([]);I={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};G=g.a(B);b=G.next();case 4:if(b.done){q.jV(6);break}w=e=b.value;D=w.actionType;y=w.entityKey;R=w.actionMetadata;if(!(D&&y&&R)||g.A(R,SpQ)){q.jV(5);break}D==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.offlineLoggingData=
I);S=g.B_(y);E=S.entityId;return g.l(q,Z_(z,[E],"mainVideoEntity",D,R),8);case 8:L=q.S,p=p.concat(L);case 5:b=G.next();q.jV(4);break;case 6:return q.return(p)}})},HtS=function(z,K){this.S=z;
this.T=K},qp8=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E;
return g.n(function(L){switch(L.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,t=[],g.Sq(L,2),g.l(L,QO_(z,p),4);case 4:t=L.S;if((B=t)==null||!B.length){L.jV(5);break}return g.l(L,bG8(z.S,K.entityKey),5);case 5:g.Eu(L,3);break;case 2:return v=g.QI(L),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.uN&&v.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
L.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,I,G));case 3:return b=[],g.l(L,xYH(z.S,"musicTrack",t),7);case 7:t=L.S;if(t.length)for(e=g.a(t),w=e.next();!w.done;w=e.next())if(D=w.value,y=D.offlineVideoData,R=void 0,(R=y)==null?0:R.videoId)S=void 0,E=Number(((S=K.actionMetadata)==null?void 0:S.priority)||0)+1,b.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y.videoId,"musicTrack",E,Ta,mq(K,y,p)));return L.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,b))}})},
mzH=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u,N8,rZ,LL,VQ,wZ,jq,i_,n1,H,Q,m,W,Y,LW,KW,hd,fW,l8,To,E9,EP,gr,zz;
return g.n(function(ZK){switch(ZK.Y){case 1:return f=Ig(K),M=K.entityKey,p=g.B_(M).entityId,t=[],B=!1,p==="!*$_ALL_ENTITIES_!*$"?(B=!0,g.l(ZK,U6(z.S,"musicAlbumRelease"),5)):g.l(ZK,TY(z.S,M,"musicAlbumRelease"),4);case 4:(v=ZK.S)&&t.push(v);ZK.jV(3);break;case 5:t=ZK.S;case 3:if((I=t)==null||!I.length)return ZK.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));if(B){G=[];b=g.a(t);for(e=b.next();!e.done;e=b.next())w=e.value,D=g.B_(w.id).entityId,G.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
D,"musicAlbumRelease",0,Ta));return ZK.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,G))}y=[];R=t[0];S=void 0;if(!R.downloadMetadata){ZK.jV(6);break}return g.l(ZK,TY(z.S,R.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:E=ZK.S,S=Number((q=(L=E)==null?void 0:L.addedTimestampMillis)!=null?q:"0")/1E3;case 6:return g.Sq(ZK,8),g.l(ZK,QO_(z,p,(V=S)==null?void 0:V.toString()),10);case 10:y=ZK.S;g.Eu(ZK,9);break;case 8:c=g.QI(ZK);if(!(c instanceof Error&&c.message===
"No data")){if(c instanceof Error&&c.message==="Empty response body")Ml(c.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.uN&&c.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ZK.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,O,x));ZK.jV(9);break}return g.l(ZK,QG(p,"musicAlbumRelease",z.S,
K,z.T),9);case 9:T=[];M8=new Map;if(($S=y)==null?0:$S.length)for(td=g.a(y),r=td.next();!r.done;r=td.next())yI=r.value,H5=yI.offlineVideoData,ra=void 0,((ra=H5)==null?0:ra.videoId)&&M8.set(H5.videoId,H5);Ho=new Map;I8=[];if((q8=R)==null?0:(P5=q8.tracks)==null?0:P5.length)for(t2=g.a(R.tracks),u=t2.next();!u.done;u=t2.next())if(N8=u.value,rZ=g.B_(N8).entityId)M8.has(rZ)?(Ho.set(rZ,M8.get(rZ)),M8.delete(rZ)):I8.push(rZ);VQ=Number(((LL=K.actionMetadata)==null?void 0:LL.priority)||0)+1;wZ=g.a(M8.entries());
for(jq=wZ.next();!jq.done;jq=wZ.next())i_=jq.value,n1=g.a(i_),H=n1.next().value,Q=n1.next().value,m=H,W=Q,T.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m,"musicTrack",VQ,Ta,mq(K,W)));Y=g.a(Ho.entries());for(LW=Y.next();!LW.done;LW=Y.next())KW=LW.value,hd=g.a(KW),fW=hd.next().value,l8=hd.next().value,To=fW,E9=l8,T.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",To,"musicTrack",VQ,Ta,mq(K,E9)));EP=g.a(I8);for(gr=EP.next();!gr.done;gr=EP.next())zz=gr.value,T.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
zz,"musicTrack",0,Ta));return ZK.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,T))}})},lBZ=function(z,K){var f,M;
return g.n(function(p){switch(p.Y){case 1:return f=Ig(K),g.Sq(p,2),M=g.B_(K.entityKey).entityId,M==="!*$_ALL_ENTITIES_!*$"?g.l(p,ql(z.S,K,z.T),5):g.l(p,QG(M,"musicAlbumRelease",z.S,K,z.T),6);case 6:return g.l(p,ebZ(z.S,K.entityKey),5);case 5:g.Eu(p,3);break;case 2:return g.QI(p),p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},QO_=function(z,K,f){var M,p,t;
return g.n(function(B){switch(B.Y){case 1:return g.l(B,hbQ([K]),2);case 2:return M=B.S,g.l(B,V45(z,M[0],f),3);case 3:return p=B.S,t=k_(p.thumbnailDetails),g.l(B,u7(t),4);case 4:return B.return(M[0].videos)}})},V45=function(z,K,f){var M,p,t,B,v,I,G,b,e,w,D,y,R,S;
return g.n(function(E){if(E.Y==1){M=K.additionalMetadadatas;p=void 0;if(M&&M.length>0)for(t=g.a(M),B=t.next();!B.done;B=t.next())if(v=B.value,v.offlineMusicPlaylistData){p=v.offlineMusicPlaylistData;break}I=K.playlistId;G=wxo(K);b=G.DB;e=G.Xn;w=f?(Number(f)*1E3).toString():Date.now().toString();D=K.lastModifiedTimestamp?(Number(K.lastModifiedTimestamp)*1E3).toString():"0";y={id:g.NA(I,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:e,lastModifiedTimestampMillis:D,addedTimestampMillis:w,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};R={id:g.NA(I,"musicAlbumRelease"),title:K.title,audioPlaylistId:I,trackCount:K.totalVideoCount,tracks:b,downloadMetadata:y.id};p&&(R.thumbnailDetails=(S=p.albumHqThumbnail)!=null?S:p.albumArtistThumbnail,R.artistDisplayName=p.albumArtistDisplayName,R.releaseDate=p.albumReleaseDate,R.contentRating={explicitType:p.albumReleaseExplicitType},R.releaseType=p.albumReleaseType);return g.l(E,om(z.S,{mode:"readwrite",B1:!0},function(L){var q=Fo(L,R,"musicAlbumRelease");
L=Fo(L,y,"musicAlbumReleaseDownloadMetadataEntity");return g.ma.all([q,L])}),2)}return E.return(R)})},nL2=function(z,K){this.S=z;
this.T=K},JSZ=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E;
return g.n(function(L){switch(L.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,t=[],g.Sq(L,2),g.l(L,W9o(z,p),4);case 4:t=L.S;if((B=t)==null||!B.length){L.jV(5);break}return g.l(L,bG8(z.S,K.entityKey),5);case 5:g.Eu(L,3);break;case 2:return v=g.QI(L),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.uN&&v.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
L.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,I,G));case 3:return b=[],g.l(L,xYH(z.S,"musicTrack",t),7);case 7:t=L.S;if(t.length)for(e=g.a(t),w=e.next();!w.done;w=e.next())if(D=w.value,y=D.offlineVideoData,R=void 0,(R=y)==null?0:R.videoId)S=void 0,E=Number(((S=K.actionMetadata)==null?void 0:S.priority)||0)+1,b.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y.videoId,"musicTrack",E,U_,mq(K,y,p)));return L.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,b))}})},
gLo=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u,N8,rZ,LL,VQ,wZ,jq,i_,n1,H,Q,m,W,Y,LW,KW,hd,fW,l8,To,E9,EP,gr,zz,ZK,Ke,EU,yV,i6,Rz,d4,Z9,ou,ld,B9,$p;
return g.n(function(Nn){switch(Nn.Y){case 1:return f=Ig(K),M=K.entityKey,p=g.B_(M).entityId,t=[],B=!1,p==="!*$_ALL_ENTITIES_!*$"?(B=!0,g.l(Nn,U6(z.S,"musicPlaylist"),5)):g.l(Nn,TY(z.S,M,"musicPlaylist"),4);case 4:(v=Nn.S)&&t.push(v);Nn.jV(3);break;case 5:t=Nn.S;case 3:if((I=t)==null||!I.length)return Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));G=g.A(K.actionMetadata,Dc4);e=(b=G)==null?void 0:b.autoSync;w=[];y=D=!0;R=!1;S=void 0;if(!B&&e===!1){Nn.jV(6);break}g.Sq(Nn,7);return g.l(Nn,
Enf(0,!!e,!0,t),9);case 9:w=Nn.S;g.Eu(Nn,8);break;case 7:E=g.QI(Nn);if(!(E instanceof Error&&E.message==="No data")){E instanceof Error&&E.message==="Empty response body"&&Ml(E.message);Nn.jV(8);break}return p==="!*$_ALL_ENTITIES_!*$"?g.l(Nn,ql(z.S,K,z.T),8):g.l(Nn,QG(p,"musicPlaylist",z.S,K,z.T),8);case 8:if(!w.length||!B&&w[0].playlistId!==p)return Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));case 6:if(B){L=[];q=g.a(w);for(V=q.next();!V.done;V=q.next())c=V.value,c.upToDate||
e&&!c.shouldAutoSyncMetadata||!c.playlistId||(O={autoSync:e},L.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c.playlistId,"musicPlaylist",0,U_,{musicPlaylistEntityActionMetadata:O})));return Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,L))}w.length&&(x=w[0],R=!!x.upToDate,e&&(D=(T=x.shouldAutoSyncMetadata)!=null?T:!0,y=(M8=x.shouldAutoSyncVideos)!=null?M8:!0,x.checkInSeconds&&(S=x.checkInSeconds)));if(R||!D)return Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f));$S=[];td=t[0];r=void 0;if(!td.downloadMetadata){Nn.jV(15);break}return g.l(Nn,TY(z.S,td.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:yI=Nn.S,r=Number((ra=(H5=yI)==null?void 0:H5.addedTimestampMillis)!=null?ra:"0")/1E3;case 15:return g.Sq(Nn,17),g.l(Nn,W9o(z,p,(Ho=r)==null?void 0:Ho.toString(),S),19);case 19:$S=Nn.S;g.Eu(Nn,18);break;case 17:I8=g.QI(Nn);if(!(I8 instanceof Error&&I8.message==="No data")){if(I8 instanceof Error&&I8.message==="Empty response body")Ml(I8.message);
else return q8="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I8 instanceof g.uN&&I8.type==="QUOTA_EXCEEDED"&&(q8="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,q8,P5));Nn.jV(18);break}return g.l(Nn,QG(p,"musicPlaylist",z.S,K,z.T),18);case 18:if(!y)return Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f));t2=[];u=new Map;if((N8=$S)==null?0:N8.length)for(rZ=g.a($S),LL=rZ.next();!LL.done;LL=rZ.next())VQ=LL.value,wZ=VQ.offlineVideoData,jq=void 0,((jq=wZ)==null?0:jq.videoId)&&u.set(wZ.videoId,wZ);i_=new Map;n1=[];if((H=td)==null?0:(Q=H.tracks)==null?0:Q.length)for(m=g.a(td.tracks),W=m.next();!W.done;W=m.next())if(Y=W.value,LW=g.B_(Y).entityId)u.has(LW)?(i_.set(LW,u.get(LW)),u.delete(LW)):n1.push(LW);hd=Number(((KW=K.actionMetadata)==null?void 0:KW.priority)||0)+1;fW=g.a(u.entries());for(l8=fW.next();!l8.done;l8=
fW.next())To=l8.value,E9=g.a(To),EP=E9.next().value,gr=E9.next().value,zz=EP,ZK=gr,t2.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",zz,"musicTrack",hd,U_,mq(K,ZK)));Ke=g.a(i_.entries());for(EU=Ke.next();!EU.done;EU=Ke.next())yV=EU.value,i6=g.a(yV),Rz=i6.next().value,d4=i6.next().value,Z9=Rz,ou=d4,t2.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Z9,"musicTrack",hd,U_,mq(K,ou)));ld=g.a(n1);for(B9=ld.next();!B9.done;B9=ld.next())$p=B9.value,t2.push(WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
$p,"musicTrack",0,U_));return Nn.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,t2))}})},it_=function(z,K){var f,M;
return g.n(function(p){switch(p.Y){case 1:return f=Ig(K),g.Sq(p,2),M=g.B_(K.entityKey).entityId,M==="!*$_ALL_ENTITIES_!*$"?g.l(p,ql(z.S,K,z.T),5):g.l(p,QG(M,"musicPlaylist",z.S,K,z.T),6);case 6:return g.l(p,ebZ(z.S,K.entityKey),5);case 5:g.Eu(p,3);break;case 2:return g.QI(p),p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},W9o=function(z,K,f,M){var p,t,B;
return g.n(function(v){switch(v.Y){case 1:return g.l(v,hbQ([K]),2);case 2:return p=v.S,g.l(v,dz2(z,p[0],f,M),3);case 3:return t=v.S,B=k_(t.thumbnailDetails),g.l(v,u7(B),4);case 4:return v.return(p[0].videos)}})},dz2=function(z,K,f,M){var p,t,B,v,I,G,b,e,w;
return g.n(function(D){return D.Y==1?(p=K.playlistId,t=wxo(K),B=t.DB,v=t.Xn,I=f?(Number(f)*1E3).toString():Date.now().toString(),G=K.lastModifiedTimestamp?(Number(K.lastModifiedTimestamp)*1E3).toString():"0",b={id:g.NA(p,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:v,lastModifiedTimestampMillis:G,addedTimestampMillis:I,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},e={id:g.NA(p,"musicPlaylist"),title:K.title,playlistId:p,thumbnailDetails:K.thumbnail,visibility:cSf(K),trackCount:K.totalVideoCount,
tracks:B,downloadMetadata:b.id},M&&(((w=e)==null?0:w.entityMetadata)?e.entityMetadata.nextAutoRefreshIntervalSeconds=String(M):e&&(e.entityMetadata={nextAutoRefreshIntervalSeconds:String(M)})),g.l(D,om(z.S,{mode:"readwrite",B1:!0},function(y){var R=Fo(y,e,"musicPlaylist");y=Fo(y,b,"musicPlaylistDownloadMetadataEntity");return g.ma.all([R,y])}),2)):D.return(e)})},cSf=function(z){switch(z.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},sO7=function(z,K){this.S=z;
this.T=K},Xm1=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y;
return g.n(function(R){switch(R.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,t=g.A(K.actionMetadata,AS_),g.Sq(R,2),g.l(R,jO2(z,p,void 0,(B=t)==null?void 0:B.track,(v=t)==null?void 0:v.albumRelease),4);case 4:if((I=t)==null?0:I.playlistId){R.jV(5);break}return g.l(R,bG8(z.S,K.entityKey),5);case 5:g.Eu(R,3);break;case 2:return G=g.QI(R),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.uN&&G.type==="QUOTA_EXCEEDED"&&
(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,b,e));case 3:D=Number(((w=K.actionMetadata)==null?void 0:w.priority)||0)+1;var S=(S=g.A(K.actionMetadata,AS_))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;y=WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"playbackData",D,Yp9,S);return R.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f,[y]))}})},xzZ=function(z,K){var f,M,p,t,B,v,I,G,b,e,w,D,y,R,S;
return g.n(function(E){switch(E.Y){case 1:return f=Ig(K),M=g.B_(K.entityKey),p=M.entityId,g.l(E,TY(z.S,K.entityKey,"musicTrack"),2);case 2:t=E.S;if(!t){B=void 0;E.jV(3);break}return g.l(E,TY(z.S,t.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:B=E.S;case 3:v=B;if(!t||!v)return E.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));G=g.A(K.actionMetadata,AS_);g.Sq(E,5);return g.l(E,jO2(z,p,v.addedTimestampMillis,(b=G)==null?void 0:b.track,(e=G)==null?void 0:e.albumRelease),
7);case 7:D=Number(((w=K.actionMetadata)==null?void 0:w.priority)||0)+1;I=WV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"playbackData",D,Yp9);g.Eu(E,6);break;case 5:y=g.QI(E);if(!(y instanceof Error&&y.message==="No data")){if(y instanceof Error&&y.message==="Empty response body")Ml(y.message);else return R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.uN&&y.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,R,S));E.jV(6);break}return g.l(E,HV(p,z.S,K,z.T),6);case 6:return E.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,I?[I]:void 0))}})},F9S=function(z,K){var f,M;
return g.n(function(p){switch(p.Y){case 1:return f=Ig(K),g.Sq(p,2),M=g.B_(K.entityKey).entityId,M==="!*$_ALL_ENTITIES_!*$"?g.l(p,ql(z.S,K,z.T),5):g.l(p,HV(M,z.S,K,z.T),6);case 6:return g.l(p,ebZ(z.S,K.entityKey),5);case 5:g.Eu(p,3);break;case 2:return g.QI(p),p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Je("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},jO2=function(z,K,f,M,p){var t,B,v,I,G,b;
return g.n(function(e){switch(e.Y){case 1:if(t=M){e.jV(2);break}return g.l(e,k$H([K]),3);case 3:B=e.S,v=B[0],t=G$Q(v);case 2:return g.l(e,Ot5(z,t,K,p,f),4);case 4:I=e.S;G=I.musicTrackEntity;b=I.n8;var w=k_(G.thumbnailDetails),D=[];b&&(D=k_(b.thumbnailDetails));return g.l(e,u7(w.concat(D)),0)}})},Ot5=function(z,K,f,M,p){var t;
return g.n(function(B){return B.Y==1?(p||(p=Date.now().toString()),t={id:g.NA(f,"musicTrackDownloadMetadataEntity"),playbackData:g.NA(f,"playbackData"),addedTimestampMillis:p,videoDownloadContextEntity:g.NA(f,"videoDownloadContextEntity")},M&&(K.albumRelease=M.id),g.l(B,om(z.S,{mode:"readwrite",B1:!0},function(v){var I=[],G=Fo(v,t,"musicTrackDownloadMetadataEntity");I.push(G);G=Fo(v,K,"musicTrack");I.push(G);M&&(v=Fo(v,M,"musicAlbumRelease"),I.push(v));return g.ma.all(I)}),2)):B.Y!=3?g.l(B,wY(f,"musicTrackDownloadMetadataEntity",
z.S,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):B.return({musicTrackEntity:K,
n8:M})})},z_=function(){rY.apply(this,arguments);
this.N="musicTrack"},rST=function(z,K,f){K=K===void 0?43200:K;
f=f===void 0?!0:f;var M=M===void 0?!1:M;var p,t;return g.n(function(B){switch(B.Y){case 1:if(!z.W.d$())return B.return([]);p=[];g.Sq(B,2);return g.l(B,Enf(K,f,M),4);case 4:p=B.S;g.Eu(B,3);break;case 2:g.QI(B);case 3:return t=zn1(z,p,f,"musicPlaylist"),B.return(t)}})},Zto=function(){g.R5.apply(this,arguments);
var z=this;this.events=new g.xI(this);this.SV=this.player.Z();this.dO={EXc:function(){return z.S},
fd:function(){return z.fd()},
B3:function(K){return z.B3(K)}}},oL8=function(z){var K;
z=g.A((K=z.getWatchNextResponse())==null?void 0:K.currentVideoEndpoint,g.f5);if(z==null?0:z.playlistId)var f=z.playlistId;return f},Cl4=function(z,K){var f,M,p,t;
return g.n(function(B){if(B.Y==1){f=K.clientPlaybackNonce;M={cpn:f,offlineSourceVisualElement:g.qe(K.vx||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};K.Y&&(M.videoFmt=Number(K.Y.itag));K.J&&(M.audioFmt=Number(K.J.itag));if((p=oL8(K))&&K.videoId){var v=K.videoId;v=p!=="PPSV"?Promise.resolve(!1):z.S.PG(v);B=g.l(B,v,3)}else B=B.jV(2);return B}B.Y!=2&&(t=B.S)&&(M.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");z.Y=f;g.Ds("offlinePlaybackStarted",M);g.Rv(B)})};
g.m8.prototype.RQ=g.pW(51,function(z){return this.app.RQ(z)});
g.hJ.prototype.RQ=g.pW(50,function(z){return g.b$v(this,9,z)});
g.h(du,iX);g.B5.Object.defineProperties(du.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.S.entityMetadata},
set:function(z){this.S.entityMetadata=z}}});
g.h(jup,du);jup.prototype.Y=function(){return[]};
g.h(Yz5,du);Yz5.prototype.Y=function(){return[]};
g.h(Xj_,du);Xj_.prototype.Y=function(){return[]};
g.h(xxQ,du);xxQ.prototype.Y=function(){return[]};
g.h(FT1,du);FT1.prototype.Y=function(){var z=[];this.S.alternateChannel&&z.push(this.S.alternateChannel);this.S.alternateChannelList&&z.push.apply(z,g.P(this.S.alternateChannelList));this.S.oneofChannelEntity&&z.push(this.S.oneofChannelEntity);return[].concat(g.P(new Set(z)))};
g.h(OD_,du);OD_.prototype.Y=function(){var z=[];this.S.entryCollection&&z.push(this.S.entryCollection);return[].concat(g.P(new Set(z)))};
g.h(rgS,iX);rgS.prototype.Y=function(){var z=[];this.S.video&&z.push(this.S.video);return[].concat(g.P(new Set(z)))};
g.h(ZD7,du);ZD7.prototype.Y=function(){var z=[];this.S.parentPlaylist&&z.push(this.S.parentPlaylist);if(this.S.entries)for(var K=g.a(this.S.entries),f=K.next();!f.done;f=K.next())z.push.apply(z,g.P((new rgS(f.value)).Y()));return[].concat(g.P(new Set(z)))};
g.h(oFo,du);oFo.prototype.Y=function(){var z=[];this.S.descriptionEntity&&z.push(this.S.descriptionEntity);this.S.creators&&z.push.apply(z,g.P(this.S.creators));this.S.theBiggestFan&&z.push(this.S.theBiggestFan);return[].concat(g.P(new Set(z)))};
g.h(CKS,du);CKS.prototype.Y=function(){return[]};
g.h(TFZ,du);TFZ.prototype.Y=function(){return[]};
g.h(UxQ,du);UxQ.prototype.Y=function(){return[]};
g.h(zmZ,du);zmZ.prototype.Y=function(){return[]};
g.h(K42,du);K42.prototype.Y=function(){return[]};
g.h($qS,du);$qS.prototype.Y=function(){return[]};
g.h(fq9,du);fq9.prototype.Y=function(){return[]};
g.h(M_9,du);M_9.prototype.Y=function(){return[]};
g.h(pF2,du);pF2.prototype.Y=function(){return[]};
g.h(t_T,du);t_T.prototype.Y=function(){var z=[];this.S.downloadsList&&z.push(this.S.downloadsList);this.S.smartDownloadsList&&z.push(this.S.smartDownloadsList);this.S.recommendedDownloadsList&&z.push(this.S.recommendedDownloadsList);this.S.refresh&&z.push(this.S.refresh);return[].concat(g.P(new Set(z)))};
g.h(Bo1,iX);Bo1.prototype.Y=function(){var z=[];this.S.video&&z.push(this.S.video);this.S.playlist&&z.push(this.S.playlist);this.S.videoItem&&z.push(this.S.videoItem);this.S.playlistItem&&z.push(this.S.playlistItem);return[].concat(g.P(new Set(z)))};
g.h(No8,du);No8.prototype.Y=function(){var z=[];this.S.refresh&&z.push(this.S.refresh);if(this.S.downloads)for(var K=g.a(this.S.downloads),f=K.next();!f.done;f=K.next())z.push.apply(z,g.P((new Bo1(f.value)).Y()));return[].concat(g.P(new Set(z)))};
g.h(vj9,du);vj9.prototype.Y=function(){var z=[];this.S.localImageEntities&&z.push.apply(z,g.P(this.S.localImageEntities));return[].concat(g.P(new Set(z)))};
g.h(IqQ,du);IqQ.prototype.Y=function(){var z=[];this.S.playbackData&&z.push(this.S.playbackData);this.S.localImageEntities&&z.push.apply(z,g.P(this.S.localImageEntities));this.S.videoDownloadContextEntity&&z.push(this.S.videoDownloadContextEntity);return[].concat(g.P(new Set(z)))};
g.h(G1p,du);G1p.prototype.Y=function(){return[]};
g.h(b_8,du);b_8.prototype.Y=function(){var z=[];this.S.fakeChildren&&z.push.apply(z,g.P(this.S.fakeChildren));return[].concat(g.P(new Set(z)))};
g.h(emp,du);emp.prototype.Y=function(){var z=[];this.S.video&&z.push(this.S.video);this.S.playbackData&&z.push(this.S.playbackData);this.S.offlineVideoPolicy&&z.push(this.S.offlineVideoPolicy);return[].concat(g.P(new Set(z)))};
g.h(wFo,du);wFo.prototype.Y=function(){return[]};
g.h(Dq8,du);Dq8.prototype.Y=function(){var z=[];this.S.channelOwner&&z.push(this.S.channelOwner);this.S.videos&&z.push.apply(z,g.P(this.S.videos));this.S.collaboratorChannels&&z.push.apply(z,g.P(this.S.collaboratorChannels));this.S.downloadState&&z.push(this.S.downloadState);this.S.refresh&&z.push(this.S.refresh);return[].concat(g.P(new Set(z)))};
g.h(yb9,du);yb9.prototype.Y=function(){var z=[];this.S.video&&z.push(this.S.video);this.S.channelContributor&&z.push(this.S.channelContributor);return[].concat(g.P(new Set(z)))};
g.h(k12,iX);k12.prototype.Y=function(){var z=[];this.S.localImageEntities&&z.push.apply(z,g.P(this.S.localImageEntities));this.S.videoDownloadContextEntity&&z.push(this.S.videoDownloadContextEntity);return[].concat(g.P(new Set(z)))};
g.h(hmp,iX);hmp.prototype.Y=function(){var z=[];this.S.recommendedVideoMetadata&&z.push.apply(z,g.P((new k12(this.S.recommendedVideoMetadata)).Y()));return[].concat(g.P(new Set(z)))};
g.h(aqf,iX);aqf.prototype.Y=function(){var z=[];this.S.playbackPosition&&z.push(this.S.playbackPosition);return[].concat(g.P(new Set(z)))};
g.h(RmQ,du);RmQ.prototype.Y=function(){var z=[];this.S.owner&&z.push(this.S.owner);this.S.downloadState&&z.push(this.S.downloadState);this.S.userState&&z.push.apply(z,g.P((new aqf(this.S.userState)).Y()));this.S.additionalMetadata&&z.push.apply(z,g.P((new hmp(this.S.additionalMetadata)).Y()));return[].concat(g.P(new Set(z)))};
g.h(S09,du);S09.prototype.Y=function(){var z=[];this.S.userChannelDetails&&z.push(this.S.userChannelDetails);return[].concat(g.P(new Set(z)))};
g.h(uU5,du);uU5.prototype.Y=function(){var z=[];this.S.channelOwner&&z.push(this.S.channelOwner);this.S.playbackPosition&&z.push(this.S.playbackPosition);this.S.localImageEntities&&z.push.apply(z,g.P(this.S.localImageEntities));this.S.downloadStatus&&z.push(this.S.downloadStatus);return[].concat(g.P(new Set(z)))};
g.h(L4o,du);L4o.prototype.Y=function(){return[]};
g.h(Ejo,du);Ejo.prototype.Y=function(){return[]};
g.h(PZT,du);PZT.prototype.Y=function(){return[]};
g.h(H_S,du);H_S.prototype.Y=function(){return[]};
g.h(QE9,du);QE9.prototype.Y=function(){return[]};
g.h(q0H,du);q0H.prototype.Y=function(){return[]};
g.h(mqf,du);mqf.prototype.Y=function(){return[]};
g.h(lq1,du);lq1.prototype.Y=function(){return[]};
g.h(V_f,du);V_f.prototype.Y=function(){return[]};
g.h(nj4,du);nj4.prototype.Y=function(){return[]};
g.h(W4S,du);W4S.prototype.Y=function(){return[]};
g.h(Jb_,du);Jb_.prototype.Y=function(){var z=[];this.S.trackDownloadMetadatas&&z.push.apply(z,g.P(this.S.trackDownloadMetadatas));return[].concat(g.P(new Set(z)))};
g.h(gj4,du);
gj4.prototype.Y=function(){var z=[];this.S.downloadedTracks&&z.push.apply(z,g.P(this.S.downloadedTracks));this.S.smartDownloadedTracks&&z.push.apply(z,g.P(this.S.smartDownloadedTracks));this.S.downloadedEpisodes&&z.push.apply(z,g.P(this.S.downloadedEpisodes));this.S.downloadedAlbumReleases&&z.push.apply(z,g.P(this.S.downloadedAlbumReleases));this.S.smartDownloadedAlbumReleases&&z.push.apply(z,g.P(this.S.smartDownloadedAlbumReleases));this.S.downloadedPlaylists&&z.push.apply(z,g.P(this.S.downloadedPlaylists));this.S.smartDownloadedPlaylists&&
z.push.apply(z,g.P(this.S.smartDownloadedPlaylists));this.S.metadataOnlyTracks&&z.push.apply(z,g.P(this.S.metadataOnlyTracks));return[].concat(g.P(new Set(z)))};
g.h(i_H,du);i_H.prototype.Y=function(){var z=[];this.S.trackDownloadMetadatas&&z.push.apply(z,g.P(this.S.trackDownloadMetadatas));return[].concat(g.P(new Set(z)))};
g.h(dq1,du);dq1.prototype.Y=function(){var z=[];this.S.playbackData&&z.push(this.S.playbackData);this.S.localImageEntities&&z.push.apply(z,g.P(this.S.localImageEntities));this.S.videoDownloadContextEntity&&z.push(this.S.videoDownloadContextEntity);return[].concat(g.P(new Set(z)))};
g.h(cbo,du);cbo.prototype.Y=function(){var z=[];this.S.musicLibraryStatusEntity&&z.push(this.S.musicLibraryStatusEntity);this.S.primaryArtists&&z.push.apply(z,g.P(this.S.primaryArtists));this.S.details&&z.push(this.S.details);this.S.userDetails&&z.push(this.S.userDetails);this.S.tracks&&z.push.apply(z,g.P(this.S.tracks));this.S.share&&z.push(this.S.share);this.S.downloadMetadata&&z.push(this.S.downloadMetadata);this.S.refresh&&z.push(this.S.refresh);return[].concat(g.P(new Set(z)))};
g.h(sEo,du);sEo.prototype.Y=function(){var z=[];this.S.albumRelease&&z.push(this.S.albumRelease);this.S.tracks&&z.push.apply(z,g.P(this.S.tracks));return[].concat(g.P(new Set(z)))};
g.h(Abp,du);Abp.prototype.Y=function(){var z=[];this.S.albumRelease&&z.push(this.S.albumRelease);return[].concat(g.P(new Set(z)))};
g.h(jE1,du);jE1.prototype.Y=function(){var z=[];this.S.details&&z.push(this.S.details);this.S.userDetails&&z.push(this.S.userDetails);return[].concat(g.P(new Set(z)))};
g.h(Y0S,du);Y0S.prototype.Y=function(){var z=[];this.S.parentArtist&&z.push(this.S.parentArtist);return[].concat(g.P(new Set(z)))};
g.h(XF1,du);XF1.prototype.Y=function(){var z=[];this.S.parentArtist&&z.push(this.S.parentArtist);return[].concat(g.P(new Set(z)))};
g.h(xq2,du);xq2.prototype.Y=function(){return[]};
g.h(F4H,du);F4H.prototype.Y=function(){return[]};
g.h(O_Z,iX);O_Z.prototype.Y=function(){var z=[];this.S.creatorEntity&&z.push(this.S.creatorEntity);return[].concat(g.P(new Set(z)))};
g.h(rb5,du);
rb5.prototype.Y=function(){var z=[];this.S.tracks&&z.push.apply(z,g.P(this.S.tracks));this.S.refresh&&z.push(this.S.refresh);this.S.musicLibraryStatusEntity&&z.push(this.S.musicLibraryStatusEntity);this.S.details&&z.push(this.S.details);this.S.downloadMetadata&&z.push(this.S.downloadMetadata);this.S.sideloadMetadata&&z.push(this.S.sideloadMetadata);this.S.userDetails&&z.push(this.S.userDetails);this.S.entryCollection&&z.push(this.S.entryCollection);this.S.share&&z.push(this.S.share);this.S.podcastShowAdditionalMetadata&&z.push.apply(z,
g.P((new O_Z(this.S.podcastShowAdditionalMetadata)).Y()));return[].concat(g.P(new Set(z)))};
g.h(Z_8,du);Z_8.prototype.Y=function(){return[]};
g.h(oj9,du);
oj9.prototype.Y=function(){var z=[];this.S.musicLibraryStatusEntity&&z.push(this.S.musicLibraryStatusEntity);this.S.artists&&z.push.apply(z,g.P(this.S.artists));this.S.audioModeVersion&&z.push(this.S.audioModeVersion);this.S.videoModeVersion&&z.push(this.S.videoModeVersion);this.S.userDetails&&z.push(this.S.userDetails);this.S.details&&z.push(this.S.details);this.S.albumRelease&&z.push(this.S.albumRelease);this.S.share&&z.push(this.S.share);this.S.libraryEdit&&z.push(this.S.libraryEdit);this.S.downloadMetadata&&
z.push(this.S.downloadMetadata);this.S.playbackPosition&&z.push(this.S.playbackPosition);this.S.lyrics&&z.push(this.S.lyrics);return[].concat(g.P(new Set(z)))};
g.h(CZT,du);CZT.prototype.Y=function(){var z=[];this.S.parentTrack&&z.push(this.S.parentTrack);return[].concat(g.P(new Set(z)))};
g.h(To2,du);To2.prototype.Y=function(){var z=[];this.S.parentTrack&&z.push(this.S.parentTrack);return[].concat(g.P(new Set(z)))};
g.h(Uq2,du);Uq2.prototype.Y=function(){return[]};
g.h(zy4,du);zy4.prototype.Y=function(){return[]};
g.h(KZ9,du);KZ9.prototype.Y=function(){return[]};
g.h($X4,du);$X4.prototype.Y=function(){return[]};
g.h(fP7,du);fP7.prototype.Y=function(){var z=[];this.S.transfer&&z.push(this.S.transfer);this.S.adsPlaybackData&&z.push.apply(z,g.P(this.S.adsPlaybackData));this.S.drmLicense&&z.push(this.S.drmLicense);this.S.offlineVideoPolicy&&z.push(this.S.offlineVideoPolicy);this.S.videoDownloadContextEntity&&z.push(this.S.videoDownloadContextEntity);return[].concat(g.P(new Set(z)))};
g.h(Mk7,du);Mk7.prototype.Y=function(){return[]};
g.h(pO5,du);pO5.prototype.Y=function(){var z=[];this.S.offlineVideoStreams&&z.push.apply(z,g.P(this.S.offlineVideoStreams));this.S.captionTrack&&z.push.apply(z,g.P(this.S.captionTrack));return[].concat(g.P(new Set(z)))};
g.h(tk4,du);tk4.prototype.Y=function(){return[]};
g.h(BB1,du);BB1.prototype.Y=function(){return[]};
g.h(NBT,du);NBT.prototype.Y=function(){return[]};
g.h(vZ7,du);vZ7.prototype.Y=function(){return[]};
g.h(IPf,du);IPf.prototype.Y=function(){return[]};
g.h(GfS,du);GfS.prototype.Y=function(){return[]};
g.h(br7,du);br7.prototype.Y=function(){return[]};
g.h(eyQ,du);eyQ.prototype.Y=function(){return[]};
g.h(wOo,du);wOo.prototype.Y=function(){return[]};
g.h(DXf,du);DXf.prototype.Y=function(){return[]};
g.h(y89,du);y89.prototype.Y=function(){return[]};
g.h(kf9,du);kf9.prototype.Y=function(){return[]};
g.h(hy2,du);hy2.prototype.Y=function(){return[]};
g.h(aP2,du);aP2.prototype.Y=function(){return[]};
g.h(Ry2,du);Ry2.prototype.Y=function(){return[]};
g.h(SA4,du);SA4.prototype.Y=function(){return[]};
g.h(uuH,du);uuH.prototype.Y=function(){return[]};
g.h(LZH,du);LZH.prototype.Y=function(){return[]};
g.h(EZQ,du);EZQ.prototype.Y=function(){return[]};
g.h(PLZ,du);PLZ.prototype.Y=function(){return[]};
g.h(HrQ,du);HrQ.prototype.Y=function(){return[]};
var P21=["browse","music/browse","unplugged/browse"],lV9=["offline/playlist_sync_check"],yy_=["offline"],HG1=["offline/offline_video_playback_position_sync"],qDp=["offline/get_playback_data_entity"],cH;s6.getInstance=function(){return g.n(function(z){return z.return(new Promise(function(K){g.fR().then(function(f){f?(s6.instance||(s6.instance=new s6(f)),K(s6.instance)):K(void 0)})}))})};
s6.prototype.get=function(z){var K=this,f,M,p;return g.n(function(t){if(t.Y==1)return g.l(t,lP8(K.token),2);if(t.Y!=3)return f=t.S,g.l(t,f.get("prefs",z),3);M=t.S;if(!M)return t.return();p=(0,g.X)();return M.expirationTimestampMs<=p?t.return():t.return(M.value)})};
s6.prototype.set=function(z,K,f){f=f===void 0?31536E3:f;var M=this,p,t,B;return g.n(function(v){if(v.Y==1)return p=(0,g.X)(),t={key:z,value:K,expirationTimestampMs:p+f*1E3},g.l(v,lP8(M.token),2);B=v.S;return g.l(v,g.cJ(B,"prefs",t),0)})};
s6.prototype.remove=function(z){var K=this,f;return g.n(function(M){if(M.Y==1)return g.l(M,lP8(K.token),2);f=M.S;return g.l(M,f.delete("prefs",z),0)})};
g.h(AF,g.UT);g.h(jB,gZZ);jB.prototype.T=function(z,K){K=dX7(K);z=(new TextEncoder).encode(JSON.stringify(z));return this.S.encrypt(z,K)};
jB.prototype.Y=function(z,K){if(!(z instanceof Uint8Array))throw Vk9(1);var f=new TextDecoder;K=dX7(K);z=this.S.decrypt(z,K);return JSON.parse(f.decode(z))};
var c8p={accountLinkStatusEntity:UxQ,booleanEntity:Xj_,buttonEntity:aP2,captionTrack:Uq2,channelHandle:jup,chipEntity:br7,commerceAcquisitionClientPayloadEntity:SA4,commerceCartListEntity:uuH,contextNoteFeedEntityPayload:Yz5,continuationTokenEntity:wFo,downloadQualityPickerEntity:fq9,downloadsPageRefreshTokenEntity:pF2,downloadsPageViewConfigurationEntity:L4o,downloadStatusEntity:M_9,dismissState:eyQ,sfvAudioItemCurrentlyPlayingEntity:vZ7,emojiFountainDataEntity:kf9,emojiCustomizationSetEntity:y89,
fakeChannel:FT1,fakePlaylist:OD_,fakePlaylistEntryCollection:ZD7,fakeVideo:oFo,fakeVideoDescription:CKS,featuredProductsEntity:V_f,flowStateEntity:TFZ,iconBadgeEntity:LZH,interstitialInteractionStateEntity:K42,likeButtonAnimationEntity:Ejo,liveChatPollStateEntity:$qS,liveViewerLeaderboardChatEntryPointStateEntity:BB1,liveViewerLeaderboardPointsEntity:NBT,liveReactionsDataEntity:hy2,logoEntity:zmZ,macroMarkerEntity:PZT,mainDownloadsLibraryEntity:t_T,mainDownloadsListEntity:No8,mainPlaylistDownloadStateEntity:vj9,
mainPlaylistEntity:Dq8,mainPlaylistVideoEntity:yb9,mainVideoDownloadStateEntity:IqQ,mainVideoEntity:RmQ,markersEngagementPanelSyncEntity:H_S,markersVisibilityOverrideEntity:QE9,musicAlbumReleaseDetail:sEo,musicAlbumReleaseDownloadMetadataEntity:Jb_,musicAlbumRelease:cbo,musicAlbumReleaseUserDetail:Abp,musicArtistDetail:Y0S,musicArtist:jE1,musicArtistUserDetail:XF1,musicDownloadsLibraryEntity:gj4,musicLibraryEdit:xq2,musicLibraryStatusEntity:F4H,musicPlaylist:rb5,musicPlaylistDownloadMetadataEntity:i_H,
musicShare:Z_8,musicTrackDetail:CZT,musicTrackDownloadMetadataEntity:dq1,musicTrack:oj9,musicTrackUserDetail:To2,offlineOrchestrationActionWrapperEntity:zy4,offlineVideoPolicy:KZ9,offlineVideoStreams:$X4,offlineabilityEntity:G1p,orchestrationWebSamplingEntity:b_8,pageHeaderEntity:wOo,pdpStateEntity:EZQ,pinnedProductEntity:nj4,playbackData:fP7,playerStateEntity:q0H,quantityIncrementerEntity:PLZ,refresh:Mk7,saveToPlaylistListEntity:IPf,settingEntity:GfS,stringEntity:xxQ,suggestedFeedbackChipStateEntity:mqf,
transfer:pO5,trendingOfferEntity:W4S,videoDownloadContextEntity:tk4,videoOverviewAsyncDataEntity:HrQ,videoPlaybackPositionEntity:Ry2,votingEntity:DXf,ytMainChannelEntity:S09,youchatPendingResponseEntity:lq1,ytMainDownloadedVideoEntity:emp,ytMainVideoEntity:uU5};g.h(ru,gZZ);ru.prototype.T=function(z){return z};
ru.prototype.Y=function(z){if(z instanceof Uint8Array)throw Vk9(0);return z};
g.h(Z7,g.J);Z7.prototype.observe=function(z){var K=this;this.observers.push(z);return function(){var f=K.observers.indexOf(z);f>=0&&K.observers.splice(f,1)}};
Z7.prototype.Y=function(z){UXo(this,z.data)};
Z7.prototype.JL=function(){this.channel.close()};
var MI_,$c_=new g.nt("elementsCommand");var E_=new g.nt("entityBatchUpdate");var Xc7=new g.nt("downloadStatusEntity");var t47=new g.nt("mainPlaylistEntityActionMetadata");var CA=new g.nt("mainVideoEntityActionMetadata");var Dc4=new g.nt("musicPlaylistEntityActionMetadata");var AS_=new g.nt("musicTrackEntityActionMetadata");var SpQ=new g.nt("localImageEntityActionMetadata");var gY=new g.nt("playbackDataActionMetadata");var fz8=new g.nt("transferEntityActionMetadata");var jl1=new g.nt("videoPlaybackPositionEntityActionMetadata");var af1;new g.ai;new g.ai;EVH.prototype.request=function(z,K,f){K=K===void 0?{}:K;return this.locks.request(z,K,function(M){return f(M)})};var fA=g.ZT.caches,$_,mY9;KA.prototype.open=function(z){return fA.open(Qif(z))};
KA.prototype.has=function(z){return fA.has(Qif(z))};
KA.prototype.delete=function(z){return fA.delete(Qif(z))};
KA.prototype.match=function(z,K){var f=this,M,p,t,B,v,I;return g.n(function(G){switch(G.Y){case 1:return g.l(G,f.keys(),2);case 2:M=G.S,p=g.a(M),t=p.next();case 3:if(t.done){G.jV(5);break}B=t.value;return g.l(G,f.open(B),6);case 6:return v=G.S,g.l(G,v.match(z,K),7);case 7:if(I=G.S)return G.return(I);t=p.next();G.jV(3);break;case 5:return G.return()}})};
g.h(HV_,KA);HV_.prototype.keys=function(){var z,K,f,M,p,t,B,v,I;return g.n(function(G){if(G.Y==1)return z=[],K=g.zN("CacheStorage keys"),g.l(G,fA.keys(),2);f=G.S;M=g.a(f);for(p=M.next();!p.done;p=M.next()){t=p.value;var b=t.indexOf(":");B=b===-1?{n_:t}:{n_:t.substring(0,b),datasyncId:t.substring(b+1)};v=B.n_;I=B.datasyncId;I===K&&z.push(v)}return G.return(z)})};g.h(pA,g.J);pA.prototype.T=function(z){this.api.LH("onOfflineOperationFailure",z.data)};
pA.prototype.J=function(z){this.api.publish("offlinetransferpause",z.data)};
pA.prototype.JL=function(){var z;(z=this.S)==null||z.close();var K;(K=this.Y)==null||K.close()};nVZ.prototype.oX=function(){this.S&&BV(this)};
nVZ.prototype.Mj=function(){this.Y&&this.Y.resolve();this.T=this.S=!1;this.N()};var az8=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var UYT="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var IV9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.h(nn4,nA);nn4.prototype.Y=function(z){return Ga(z)?gno(this,z):b7(z)?cyo(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.h(slf,nA);slf.prototype.Y=function(z){return b7(z)?Ayo(this,z):YEQ(z)?YDo(this,z):eM(z)?Xx1(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.k=xcH.prototype;g.k.niH=function(z){var K=this,f,M,p,t;return g.n(function(B){if(!g.Z(z.state,128))return B.jV(0);f=z.state.Pj;var v=(M=f)==null?void 0:M.errorCode,I=(p=f)==null?void 0:p.gB;t=v==="net.connect"&&I===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(v==null?0:v.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.l(B,K.Ig(K.player.getVideoData().videoId,t),0)})};
g.k.Ig=function(z,K){var f=this;return g.n(function(M){if(M.Y==1){if(f.Y)return M.return();f.Y=!0;return K==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(cV(f,z,!1,!0),M.jV(0)):g.l(M,dY(f,z),3)}g.i1(z,4);return g.l(M,f.S.Ig(K),0)})};
g.k.wA=function(z){z.status===2?(z.status!==this.T&&(AUf(this.S),g.i1(z.videoId,2)),z.WR&&FQH(this.S,z.videoId,z.WR)):z.status===4?(dY(this,z.videoId),this.Ig(z.videoId,z.Ks?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):z.status===1&&xi7(this.S);this.T=z.status;this.api.LH("localmediachange",{videoId:z.videoId,status:z.status})};
g.k.nm=function(){var z=this,K;return g.n(function(f){if(f.Y==1){if(z.Y)return f.return();z.Y=!0;K=z.player.getVideoData().videoId;return g.l(f,dY(z,K),2)}return g.l(f,z.S.nm(),0)})};
g.k.bK=function(z){switch(z){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.k.B=function(z){return this.api.Z().B(z)};g.h(Th2,nA);Th2.prototype.Y=function(z){return Ga(z)?z31(this,z):b7(z)?KQf(this,z):YEQ(z)?$i_(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};Ny4.prototype.S=function(z,K){var f=z.action.actionMetadata.priority-K.action.actionMetadata.priority;f===0&&(z.S<K.S?f=-1:z.S>K.S&&(f=1));return f};g.h(s_,g.J);s_.prototype.JL=function(){this.N&&this.N();g.J.prototype.JL.call(this)};
s_.prototype.createAction=function(z,K){var f=g.B_(z.entityKey).entityType,M=g.q1(16);return new he(f,M,z,K.actionId,K.rootActionId)};
s_.prototype.l_=function(z){var K=this,f,M,p,t,B,v,I,G,b;return g.n(function(e){if(e.Y==1){if(K.CH())return e.return();M=(f=z.offlineOrchestrationActionWrapperEntity)!=null?f:new Set;p=[];t=g.a(M);for(B=t.next();!B.done;B=t.next())v=B.value,I=g.B_(v),G=I.entityId,GJ5(K.S,G)||p.push(v);return g.l(e,uiQ(K,p),2)}b=e.S;return g.l(e,S85(K,b),0)})};
s_.prototype.retry=function(){var z=this;return g.n(function(K){return g.l(K,LQf(z),0)})};Pxp.prototype.ij=function(z,K){K=K===void 0?!0:K;var f=this,M,p,t,B,v,I,G,b;return g.n(function(e){switch(e.Y){case 1:if(!f.S)return e.return();M=[];p=g.MN(f.S.Y,K);t=[];for(B={tM:0};B.tM<p.length;B={tM:B.tM},B.tM++)v=p[B.tM],I=f.S.vD(v,"json3"),G=g.gV(I,{withCredentials:!0,format:"RAW"},3,500).then(function(w){return function(D){D={metadata:g.S1(p[w.tM]),trackData:D.xhr.responseText};t.push(D)}}(B)).Qf(function(w){Ml("Caption fetch error",w)}),M.push(G);
return g.l(e,Ag8(M),2);case 2:return g.Sq(e,3),g.l(e,bV5(z,t),5);case 5:g.Eu(e,0);break;case 3:b=g.QI(e),Ml("Caption DB transaction error",b),g.Rv(e)}})};g.h(Ae,g.J);Ae.prototype.JL=function(){this.Y&&this.Y();g.J.prototype.JL.call(this)};
Ae.prototype.T=function(z){var K=this,f,M,p,t,B,v,I,G;return g.n(function(b){M=(f=z.transfer)!=null?f:new Set;p=[];t=g.a(M);for(B=t.next();!B.done;B=t.next())v=B.value,I=g.B_(v),G=I.entityId,p.push(G);return p.length===0?b.return():g.l(b,q88(K,p),0)})};g.h(WQ4,g.J);g.k=WQ4.prototype;g.k.JL=function(){this.nH&&this.nH();this.Hx.dispose();this.J.dispose();this.vx&&g.BO(this.W.j1,this.vx);this.Bx&&g.BO(this.W.j1,this.Bx);g.J.prototype.JL.call(this)};
g.k.VUe=function(z){var K=this,f,M,p;return g.n(function(t){switch(t.Y){case 1:f=g.NA(z,"transfer");if(K.S&&f===K.S.key){cV(K.G,K.C,!0);K.J.stop();t.jV(0);break}return g.l(t,om(K.Y,{mode:"readwrite",B1:!0},function(B){return Yu(B,f,"transfer").then(function(v){if(v&&v.transferState!=="TRANSFER_STATE_COMPLETE"&&v.transferState!=="TRANSFER_STATE_FAILED")return v.transferState="TRANSFER_STATE_PAUSED_BY_USER",Fo(B,v,"transfer").then(function(){return v})})}),3);
case 3:M=t.S;if(!M){t.jV(0);break}if(!z||!K.T){t.jV(5);break}return g.l(t,wY(z,K.T,K.Y,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.l(t,x_(K,z),7);case 7:p=t.S,Am1({videoId:z,MC:M,offlineModeType:p}),g.Rv(t)}})};
g.k.Qch=function(){var z=this;if(this.S&&this.C){cV(this.G,this.C,!1);var K=this.S,f=(K==null?0:K.key)?g.B_(K.key).entityId:"";f&&this.T&&(new Promise(function(M,p){wY(f,z.T,z.Y,"DOWNLOAD_STATE_PAUSED").catch(function(t){p(t)})})).catch(function(M){Ml("Download state setting error",M)})}this.J.stop()};
g.k.sy=function(){this.S?il2(this,this.S):Y_(this)};
g.k.uf=function(z){var K=this;return g.n(function(f){switch(f.Y){case 1:if(!K.S){f.jV(2);break}if(K.S.transferState==="TRANSFER_STATE_COMPLETE"||K.S.transferState==="TRANSFER_STATE_FAILED"||!z.transfer||!z.transfer.has(K.S.key)){f.jV(3);break}return g.l(f,TY(K.Y,K.S.key,"transfer"),4);case 4:K.S=f.S;if(K.S){f.jV(3);break}return g.l(f,diS(K),3);case 3:if(K.S)return f.return();case 2:return g.l(f,Y_(K),0)}})};
g.k.Ig=function(z,K){var f=this,M,p,t,B,v;return g.n(function(I){switch(I.Y){case 1:if(!f.S){FR(f,"onTransferFailure: "+z);I.jV(2);break}M=f.S;t=((p=M)==null?0:p.key)?g.B_(M.key).entityId:"";a:switch(z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var G=!1;break a;default:G=!0}return G&&Ol7(f)?g.l(I,O_(f,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.l(I,
rU_(f,z),5);case 5:if(!t||!f.T){I.jV(2);break}return g.l(I,wY(t,f.T,f.Y,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.l(I,x_(f,t),9);case 9:B=I.S;vV({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:t,MC:M,offlineModeType:B});if(!t||!f.T){I.jV(2);break}return g.l(I,wY(t,f.T,f.Y,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:jM(f),v=Y_(f,!0),K&&K(v),g.Rv(I)}})};
g.k.nm=function(z){var K=this,f,M,p,t,B,v,I,G,b,e,w,D;return g.n(function(y){switch(y.Y){case 1:if(!K.S){FR(K,"onMaybeTransferStreamsExpired");y.jV(2);break}return Ol7(K)?g.l(y,O_(K,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.l(y,rU_(K,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!K.T){y.jV(2);break}f=K.S;p=((M=f)==null?0:M.key)?g.B_(f.key).entityId:"";if(!p){y.jV(2);break}return g.l(y,wY(p,K.T,K.Y,"DOWNLOAD_STATE_FAILED"),2);case 9:return K.S||FR(K,"onMaybeTransferStreamsExpiredRetryAttempting"),
t=K.S,v=((B=t)==null?0:B.key)?g.B_(t.key).entityId:"",g.l(y,x_(K,v),10);case 10:return I=y.S,vV({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:v,MC:t,offlineModeType:I}),G=OV_(),g.Om(G,gY,{isEnqueuedForExpiredStreamUrlRefetch:!0}),b=g.NA(v,"playbackData"),e={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:b,actionMetadata:G},w=Rg(new he("playbackData",v,e)),g.l(y,C4(K.Y,w,"offlineOrchestrationActionWrapperEntity"),2);case 2:jM(K),D=Y_(K,!0),
z&&z(D),g.Rv(y)}})};
var TeH={},Zl2=(TeH.TRANSFER_STATE_TRANSFERRING=1,TeH.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,TeH);g.k=rY.prototype;g.k.yZ=function(){return this.C.promise};
g.k.HN=function(){if(this.Y&&this.G)return this.C.promise;Ty9(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.k.Kr=function(z){var K={};return K.playbackData=new nn4(z,this.SV,this.S),K.transfer=new Th2(z,this.SV),K.videoPlaybackPositionEntity=new slf(z,this.SV),K};
g.k.PQ=function(){var z=this;return g.n(function(K){return z.Y?g.l(K,JU7(z.Y),0):K.jV(0)})};
g.k.hs=function(){var z=this,K,f;return g.n(function(M){if(M.Y==1)return z.Y||z.G?g.l(M,z.yZ(),2):M.return();z.D!==void 0&&(g.EJ(z.D),z.D=void 0);z.J!==void 0&&(g.EJ(z.J),z.J=void 0);(K=z.Y)==null||K.dispose();z.Y=void 0;(f=z.G)==null||f.dispose();z.G=void 0;z.api.LH("onOrchestrationLostLeader");z.C=new g.ai;g.Rv(M)})};
g.k.isOrchestrationLeader=function(){return this.T.S};
g.k.PG=function(){return g.n(function(z){return z.return(!1)})};
g.k.QA=function(z){var K=this.S;K.api.publish("offlinetransferpause",z);var f;(f=K.Y)==null||f.postMessage(z)};
g.k.sy=function(z){var K,f;return g.n(function(M){if(M.Y==1)return g.l(M,za(),2);K=M.S;if(!K)return M.return();f=g.NA(z,"transfer");return g.l(M,om(K,{mode:"readwrite",B1:!0},function(p){var t=Yu(p,f,"transfer"),B=Yu(p,g.NA(z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ma.all([t,B]).then(function(v){v=g.a(v);var I=v.next().value;var G=v.next().value;return I&&I.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(I.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Fo(p,I,"transfer").then(function(){vV({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:z,MC:I,offlineModeType:G==null?void 0:G.offlineModeType});return g.ma.resolve(null)})):g.ma.resolve(null)})}),0)})};
g.k.q4=function(z){z=z===void 0?43200:z;var K=this,f,M,p,t,B,v,I,G;return g.n(function(b){if(b.Y==1)return K.W.d$()?g.l(b,za(),2):b.return(Ui9());if(b.Y!=3){f=b.S;if(!f)return b.return([]);M=Date.now()/1E3;return g.l(b,U6(f,"offlineVideoPolicy"),3)}p=b.S;t=[];B=g.a(p);for(v=B.next();!v.done;v=B.next())I=v.value,Number(I.lastUpdatedTimestampSeconds)+z<=M&&(G=g.B_(I.key).entityId,t.push(G));return t.length?b.return(Z_(K,t,K.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):b.return([])})};
g.k.deleteAll=function(){return Z_(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.k.refreshAllStaleEntities=function(z){var K=this;return g.n(function(f){return f.Y==1?g.l(f,K.q4(z),2):f.return(f.S)})};
g.k.setUpPositionSyncInterval=function(z){var K=this;this.J!==void 0&&(g.EJ(this.J),this.J=void 0);var f=z!=null?z:864E5;this.J=g.um(function(){K.Xz(f)},f)};
g.k.Xz=function(z){var K=this,f,M,p,t,B,v;return g.n(function(I){switch(I.Y){case 1:return g.Sq(I,2),g.l(I,s6.getInstance(),4);case 4:f=I.S;if(!f)throw Error("prefStorage is undefined");return g.l(I,f.get("psi"),5);case 5:M=I.S;t=((p=M)==null?0:p.UQ)?Number(M.UQ)/1E3:0;B=Date.now();if(!(t+z<=B)){I.jV(6);break}return g.l(I,Z_(K,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Eu(I,0);break;case 2:v=g.QI(I),Ml("Offline manager error",v),
g.Rv(I)}})};
g.k.Id=function(){var z=this,K,f,M,p,t,B,v;return g.n(function(I){if(I.Y==1)return g.l(I,za(),2);if(I.Y!=3)return(K=I.S)?g.l(I,U6(K,"transfer"),3):I.return([]);f=I.S;M=[];p=g.a(f);for(t=p.next();!t.done;t=p.next())B=t.value,B.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&B.key&&(v=g.B_(B.key).entityId,M.push(v));return I.return(K9Z(z,M))})};
g.k.uQ=function(){return g.n(function(z){return z.return([])})};
g.k.Fe=function(){return g.n(function(z){g.Rv(z)})};
g.k.Ly=function(){return g.n(function(z){g.Rv(z)})};g.h($zf,nA);$zf.prototype.Y=function(z){return Ga(z)?pmT(this,z):b7(z)?Bep(this,z):eM(z)?Nef(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var og=[10];g.h(en2,nA);en2.prototype.Y=function(z){return Ga(z)?yST(this,z):b7(z)?kE2(this,z):eM(z)?hnS(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var Dz4=[10];g.h(Rn2,nA);Rn2.prototype.Y=function(z){return b7(z)?uPZ(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};g.h(L9_,rY);g.k=L9_.prototype;g.k.Kr=function(z){var K=rY.prototype.Kr.call(this,z);K.mainVideoEntity=new en2(z,this.SV,this.S);K.mainPlaylistEntity=new $zf(z,this.SV,this.S);K.mainDownloadsListEntity=new Rn2(z,this.SV,this.S);return K};
g.k.refreshAllStaleEntities=function(z,K){var f=this,M,p,t,B,v,I,G,b,e,w,D;return g.n(function(y){switch(y.Y){case 1:M=[];if(!f.SV.B("web_player_offline_playlist_auto_refresh")){y.jV(2);break}return g.l(y,ELT(f,z,K),3);case 3:M=y.S;case 2:return g.l(y,s6.getInstance(),4);case 4:return p=y.S,g.l(y,(t=p)==null?void 0:t.get("sdois"),5);case 5:return B=y.S,g.l(y,(v=p)==null?void 0:v.get("lmqf"),6);case 6:I=y.S;if(!B){y.jV(7);break}b=M;e=b.concat;return g.l(y,PlH(f,B,(G=I)!=null?G:"SD",z===0),8);case 8:M=
e.call(b,y.S);case 7:return w=M,D=w.concat,g.l(y,rY.prototype.refreshAllStaleEntities.call(f,z,K),9);case 9:return M=D.call(w,y.S),y.return(M)}})};
g.k.PG=function(z){var K,f,M,p,t,B,v,I;return g.n(function(G){if(G.Y==1)return g.l(G,za(),2);if(G.Y!=3)return(K=G.S)?g.l(G,TY(K,g.i9,"mainDownloadsListEntity"),3):G.return(!1);f=G.S;if((M=f)==null?0:(p=M.downloads)==null?0:p.length)for(t=g.NA(z,"mainVideoEntity"),B=g.a(f.downloads),v=B.next();!v.done;v=B.next())if(I=v.value,I.videoItem===t)return G.return(!0);return G.return(!1)})};
g.k.uQ=function(){var z=this,K,f,M,p,t,B,v,I;return g.n(function(G){if(G.Y==1)return g.l(G,za(),2);if(G.Y!=3)return(K=G.S)?g.l(G,U6(K,"downloadStatusEntity"),3):G.return([]);f=G.S;M=[];p=g.a(f);for(t=p.next();!t.done;t=p.next())B=t.value,B.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&B.key&&(v=g.B_(B.key).entityId,M.push(v));return M.length?(I={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},G.return(Z_(z,M,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
I))):G.return([])})};
g.k.Ly=function(){var z;return g.n(function(K){return K.Y==1?g.l(K,za(),2):(z=K.S)?g.l(K,om(z,{mode:"readwrite",B1:!0},function(f){return Xo(f,"mainVideoEntity").then(function(M){var p=[];M=g.a(M);for(var t=M.next();!t.done;t=M.next()){t=t.value;var B=void 0;(B=t.userState)!=null&&B.playbackPosition||(B=g.B_(t.key).entityId,B={key:g.NA(B,"videoPlaybackPositionEntity"),videoId:B,lastPlaybackPositionSeconds:"0"},p.push(Fo(f,B,"videoPlaybackPositionEntity")),t.userState={playbackPosition:B.key},p.push(Fo(f,
t,"mainVideoEntity")))}return g.ma.all(p)})}),0):K.return()})};
g.k.Fe=function(){var z,K,f,M,p,t,B,v,I,G,b,e,w,D,y,R,S,E,L,q,V,c,O,x,T,M8,$S,td,r,yI,H5,ra,Ho,I8,q8,P5,t2,u;return g.n(function(N8){if(N8.Y==1)return g.l(N8,za(),2);if(N8.Y!=3){z=N8.S;if(!z)return N8.return();K=g.NA("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.l(N8,om(z,{mode:"readonly",B1:!0},function(rZ){return g.ma.all([Yu(rZ,K,"mainDownloadsListEntity"),Yu(rZ,g.i9,"mainDownloadsListEntity"),Xo(rZ,"mainVideoEntity"),Xo(rZ,"mainPlaylistEntity")])}),3)}f=N8.S;
M=g.a(f);p=M.next().value;t=M.next().value;B=M.next().value;v=M.next().value;I=p;G=t;b=B;e=v;w=new Set;if((D=I)==null?0:(y=D.downloads)==null?0:y.length)for(R=g.a(I.downloads),S=R.next();!S.done;S=R.next())E=S.value,L=void 0,(q=(L=E.videoItem)!=null?L:E.playlistItem)&&w.add(q);if((V=G)==null?0:(c=V.downloads)==null?0:c.length)for(O=g.a(G.downloads),x=O.next();!x.done;x=O.next())T=x.value,T.videoItem&&w.add(T.videoItem);M8=new Set;$S=[];td=g.a(e);for(r=td.next();!r.done;r=td.next()){yI=r.value;if(yI.videos)for(H5=
g.a(yI.videos),ra=H5.next();!ra.done;ra=H5.next())Ho=ra.value,(I8=JSON.parse(g.B_(Ho).entityId).videoId)&&M8.add(I8);yI.key&&!w.has(yI.key)&&$S.push(yI.key)}q8=g.a(b);for(P5=q8.next();!P5.done;P5=q8.next())t2=P5.value,t2.key&&!w.has(t2.key)&&(u=g.B_(t2.key).entityId,M8.has(u)||$S.push(t2.key));return $S.length?g.l(N8,tPS(z,$S),0):N8.jV(0)})};g.h(HtS,nA);HtS.prototype.Y=function(z){return Ga(z)?qp8(this,z):b7(z)?mzH(this,z):eM(z)?lBZ(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var Ta=[10];g.h(nL2,nA);nL2.prototype.Y=function(z){return Ga(z)?JSZ(this,z):b7(z)?gLo(this,z):eM(z)?it_(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var U_=[10];g.h(sO7,nA);sO7.prototype.Y=function(z){return Ga(z)?Xm1(this,z):b7(z)?xzZ(this,z):eM(z)?F9S(this,z):Promise.reject(Error("Unsupported action type: "+z.actionType))};
var Yp9=[10];g.h(z_,rY);z_.prototype.Kr=function(z){var K=rY.prototype.Kr.call(this,z);K.musicTrack=new sO7(z,this.S);K.musicPlaylist=new nL2(z,this.S);K.musicAlbumRelease=new HtS(z,this.S);return K};
z_.prototype.refreshAllStaleEntities=function(z,K){var f=this,M,p,t;return g.n(function(B){if(B.Y==1)return g.l(B,rST(f,z,K),2);if(B.Y!=3)return p=M=B.S,t=p.concat,g.l(B,rY.prototype.refreshAllStaleEntities.call(f,z,K),3);M=t.call(p,B.S);return B.return(M)})};g.h(Zto,g.R5);g.k=Zto.prototype;g.k.create=function(){var z=this;g.d(this,this.events);if(g.$t(this.SV))this.S=new L9_(this.SV,this.player);else if(g.O$(this.SV)||g.tw(this.SV)==="WEB_MUSIC_INTEGRATIONS")this.S=new z_(this.SV,this.player);this.events.X(this.player,"onPlaybackStartExternal",function(){z.fd()});
this.events.X(this.player,"videodatachange",function(){z.fd()});
this.SV.B("html5_offline_playback_position_sync")&&this.events.X(this.player,"presentingplayerstatechange",this.B3)};
g.k.g_=function(){return!1};
g.k.lF=function(z,K,f,M){var p=this;return g.n(function(t){return p.S?t.return(Z_(p.S,z,K,f,M)):t.return(Promise.reject())})};
g.k.deleteAll=function(){return this.S.deleteAll()};
g.k.q4=function(z){return this.S.q4(z)};
g.k.refreshAllStaleEntities=function(z){return this.S.refreshAllStaleEntities(z)};
g.k.setUpPositionSyncInterval=function(z){this.S.setUpPositionSyncInterval(z)};
g.k.QA=function(z){this.S.QA(z)};
g.k.sy=function(z){return this.S.sy(z)};
g.k.fd=function(){var z=this,K;return g.n(function(f){K=z.player.getVideoData();return g.op(K)?oL8(K)&&z.Y!==K.clientPlaybackNonce?g.l(f,Cl4(z,K),0):f.jV(0):f.return()})};
g.k.B3=function(z){var K=this,f,M,p,t,B,v,I;return g.n(function(G){if(G.Y==1)return f=K.player.getVideoData(),M=f.ra,g.Ld(z,2)||g.Ld(z,512)?g.l(G,za(),2):G.return();if(G.Y!=3){p=G.S;if(!p)return Ml("PES is undefined"),G.return();t=f.videoId;return g.l(G,TY(p,g.NA(t,"mainVideoEntity"),"mainVideoEntity"),3)}B=G.S;if(!B)return G.return();v=Math.floor(M).toString();I={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:v}};return g.l(G,K.lF([t],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
I),0)})};
g.k.isOrchestrationLeader=function(){return this.S.isOrchestrationLeader()};
g.k.updateDownloadState=function(z,K){var f,M,p,t;return g.n(function(B){if(B.Y==1)return g.l(B,za(),2);f=B.S;if(!f)return Ml("PES is undefined"),B.return();M=g.B_(z);p=M.entityType;t=M.entityId;return g.l(B,wY(t,p,f,K,!0),0)})};g.a5("offline",Zto);})(_yt_player);
